ˆ
cD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\ViewModels\TaxViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *

ViewModels* 4
;4 5
public 
class 
TaxViewModel 
: 
BaseViewModel )
{ 
public		 

string		 
Name		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public

 

string

 
Description

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

decimal 

Percentage 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
public 

CategoryViewModel 
Category %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

TaxViewModel 
( 
Guid 
id 
, 
string 
name 
, 
string 
description 
, 
decimal 

percentage 
, 
Guid 

idCategory 
, 
CategoryViewModel 
category "
," #
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime 
? 
	deletedAt 
) 
: 
base #
(# $
id$ &
,& '
	createdAt( 1
,1 2
	updatedAt3 <
,< =
	deletedAt> G
)G H
{ 
Name 
= 
name 
; 
Description 
= 
description !
;! "

Percentage 
= 

percentage 
;  

IdCategory 
= 

idCategory 
;  
Category 
= 
category 
; 
}   
public"" 

static"" 
TaxViewModel"" 

FromEntity"" )
("") *
Tax""* -
entity"". 4
)""4 5
{## 
return$$ 
new$$ 
TaxViewModel$$ 
($$  
entity%% 
.%% 
Id%% 
,%% 
entity&& 
.&& 
Name&& 
,&& 
entity'' 
.'' 
Description'' 
,'' 
entity(( 
.(( 

Percentage(( 
,(( 
entity)) 
.)) 

IdCategory)) 
,)) 
CategoryViewModel** 
.** 

FromEntity** (
(**( )
entity**) /
.**/ 0
Category**0 8
)**8 9
,**9 :
entity++ 
.++ 
	CreatedAt++ 
,++ 
entity,, 
.,, 
	UpdatedAt,, 
,,, 
entity-- 
.-- 
	DeletedAt-- 
)-- 
;-- 
}.. 
}// ¿

bD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Queries\SearchTaxQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Queries* 1
;1 2
public 
class 
SearchTaxQuery 
: 

BaseSearch (
,( )
IRequest* 2
<2 3

BaseResult3 =
<= >
TaxViewModel> J
>J K
>K L
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
string

' -
.

- .
Empty

. 3
;

3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

decimal 

Percentage 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
} î^
rD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Queries\Handlers\SearchTaxQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Taxes		$ )
.		) *
Queries		* 1
.		1 2
Handlers		2 :
;		: ;
public 
class !
SearchTaxQueryHandler "
:# $
IRequestHandler% 4
<4 5
SearchTaxQuery5 C
,C D

BaseResultE O
<O P
TaxViewModelP \
>\ ]
>] ^
{ 
private 
readonly 
ITaxRepository #
_taxRepository$ 2
;2 3
public 
!
SearchTaxQueryHandler  
(  !
ITaxRepository! /
taxRepository0 =
)= >
{ 
_taxRepository 
= 
taxRepository &
;& '
} 
public 

async 
Task 
< 

BaseResult  
<  !
TaxViewModel! -
>- .
>. /
Handle0 6
(6 7
SearchTaxQuery 
request 
, 
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
Tax 
, 
bool !
>! "
>" #
?# $
filter% +
=, -
null. 2
;2 3
Func 
< 

IQueryable 
< 
Tax 
> 
, 
IOrderedQueryable /
</ 0
Tax0 3
>3 4
>4 5
?5 6
ordeBy7 =
=> ?
null@ D
;D E
if 

( 
! 
string 
. 
IsNullOrWhiteSpace &
(& '
request' .
.. /
Name/ 3
)3 4
)4 5
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Name' +
==, .
request/ 6
.6 7
Name7 ;
); <
;< =
} 	
if   

(   
!   
string   
.   
IsNullOrWhiteSpace   &
(  & '
request  ' .
.  . /
Description  / :
)  : ;
)  ; <
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
Tax$$. 1
>$$1 2
($$2 3
true$$3 7
)$$7 8
;$$8 9
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
Description''' 2
==''3 5
request''6 =
.''= >
Description''> I
)''I J
;''J K
}(( 	
if** 

(** 
request** 
.** 

Percentage** 
!=** !
$num**" #
)**# $
{++ 	
if,, 
(,, 
filter,, 
==,, 
null,, 
),, 
{-- 
filter.. 
=.. 
PredicateBuilder.. )
...) *
New..* -
<..- .
Tax... 1
>..1 2
(..2 3
true..3 7
)..7 8
;..8 9
}// 
filter11 
=11 
filter11 
.11 
And11 
(11  
x11  !
=>11" $
x11% &
.11& '

Percentage11' 1
==112 4
request115 <
.11< =

Percentage11= G
)11G H
;11H I
}22 	
if44 

(44 
!44 
string44 
.44 
IsNullOrWhiteSpace44 &
(44& '
request44' .
.44. /
Order44/ 4
)444 5
)445 6
{55 	
switch66 
(66 
request66 
.66 
Order66 !
)66! "
{77 
case88 
$str88 
:88 
ordeBy99 
=99 
x99 
=>99 !
x99" #
.99# $
OrderBy99$ +
(99+ ,
n99, -
=>99. 0
n991 2
.992 3
Name993 7
)997 8
;998 9
break:: 
;:: 
case<< 
$str<< "
:<<" #
ordeBy== 
=== 
x== 
=>== !
x==" #
.==# $
OrderBy==$ +
(==+ ,
n==, -
=>==. 0
n==1 2
.==2 3
Description==3 >
)==> ?
;==? @
break>> 
;>> 
case@@ 
$str@@ !
:@@! "
ordeByAA 
=AA 
xAA 
=>AA !
xAA" #
.AA# $
OrderByAA$ +
(AA+ ,
nAA, -
=>AA. 0
nAA1 2
.AA2 3

PercentageAA3 =
)AA= >
;AA> ?
breakBB 
;BB 
caseDD 
$strDD  
:DD  !
ordeByEE 
=EE 
xEE 
=>EE !
xEE" #
.EE# $
OrderByEE$ +
(EE+ ,
nEE, -
=>EE. 0
nEE1 2
.EE2 3
	CreatedAtEE3 <
)EE< =
;EE= >
breakFF 
;FF 
caseHH 
$strHH  
:HH  !
ordeByII 
=II 
xII 
=>II !
xII" #
.II# $
OrderByII$ +
(II+ ,
nII, -
=>II. 0
nII1 2
.II2 3
	UpdatedAtII3 <
)II< =
;II= >
breakJJ 
;JJ 
caseLL 
$strLL  
:LL  !
ordeByMM 
=MM 
xMM 
=>MM !
xMM" #
.MM# $
OrderByMM$ +
(MM+ ,
nMM, -
=>MM. 0
nMM1 2
.MM2 3
	DeletedAtMM3 <
)MM< =
;MM= >
breakNN 
;NN 
defaultPP 
:PP 
ordeByQQ 
=QQ 
xQQ 
=>QQ !
xQQ" #
.QQ# $
OrderByQQ$ +
(QQ+ ,
nQQ, -
=>QQ. 0
nQQ1 2
.QQ2 3
IdQQ3 5
)QQ5 6
;QQ6 7
breakRR 
;RR 
}SS 
}TT 	
ifVV 

(VV 
requestVV 
.VV 

IdCategoryVV 
!=VV !
GuidVV" &
.VV& '
EmptyVV' ,
)VV, -
{WW 	
ifXX 
(XX 
filterXX 
==XX 
nullXX 
)XX 
{YY 
filterZZ 
=ZZ 
PredicateBuilderZZ )
.ZZ) *
NewZZ* -
<ZZ- .
TaxZZ. 1
>ZZ1 2
(ZZ2 3
trueZZ3 7
)ZZ7 8
;ZZ8 9
}[[ 
filter]] 
=]] 
filter]] 
.]] 
And]] 
(]]  
x]]  !
=>]]" $
x]]% &
.]]& '

IdCategory]]' 1
==]]2 4
request]]5 <
.]]< =

IdCategory]]= G
)]]G H
;]]H I
}^^ 	
if`` 

(`` 
request`` 
.`` 
Id`` 
!=`` 
Guid`` 
.`` 
Empty`` $
)``$ %
{aa 	
ifbb 
(bb 
filterbb 
==bb 
nullbb 
)bb 
{cc 
filterdd 
=dd 
PredicateBuilderdd )
.dd) *
Newdd* -
<dd- .
Taxdd. 1
>dd1 2
(dd2 3
truedd3 7
)dd7 8
;dd8 9
}ee 
filtergg 
=gg 
filtergg 
.gg 
Andgg 
(gg  
xgg  !
=>gg" $
xgg% &
.gg& '
Idgg' )
==gg* ,
requestgg- 4
.gg4 5
Idgg5 7
)gg7 8
;gg8 9
}hh 	
ifjj 

(jj 
requestjj 
.jj 
	CreatedAtjj 
!=jj  
defaultjj! (
)jj( )
{kk 	
ifll 
(ll 
filterll 
==ll 
nullll 
)ll 
{mm 
filternn 
=nn 
PredicateBuildernn )
.nn) *
Newnn* -
<nn- .
Taxnn. 1
>nn1 2
(nn2 3
truenn3 7
)nn7 8
;nn8 9
}oo 
filterqq 
=qq 
filterqq 
.qq 
Andqq 
(qq  
xqq  !
=>qq" $
xqq% &
.qq& '
	CreatedAtqq' 0
==qq1 3
requestqq4 ;
.qq; <
	CreatedAtqq< E
)qqE F
;qqF G
}rr 	
iftt 

(tt 
requesttt 
.tt 
	UpdatedAttt 
!=tt  
defaulttt! (
)tt( )
{uu 	
ifvv 
(vv 
filtervv 
==vv 
nullvv 
)vv 
{ww 
filterxx 
=xx 
PredicateBuilderxx )
.xx) *
Newxx* -
<xx- .
Taxxx. 1
>xx1 2
(xx2 3
truexx3 7
)xx7 8
;xx8 9
}yy 
filter{{ 
={{ 
filter{{ 
.{{ 
And{{ 
({{  
x{{  !
=>{{" $
x{{% &
.{{& '
	UpdatedAt{{' 0
=={{1 3
request{{4 ;
.{{; <
	UpdatedAt{{< E
){{E F
;{{F G
}|| 	
if~~ 

(~~ 
request~~ 
.~~ 
	DeletedAt~~ 
.~~ 
HasValue~~ &
||~~' )
request~~* 1
.~~1 2
	DeletedAt~~2 ;
!=~~< >
default~~? F
)~~F G
{ 	
if
ÄÄ 
(
ÄÄ 
filter
ÄÄ 
==
ÄÄ 
null
ÄÄ 
)
ÄÄ 
{
ÅÅ 
filter
ÇÇ 
=
ÇÇ 
PredicateBuilder
ÇÇ )
.
ÇÇ) *
New
ÇÇ* -
<
ÇÇ- .
Tax
ÇÇ. 1
>
ÇÇ1 2
(
ÇÇ2 3
true
ÇÇ3 7
)
ÇÇ7 8
;
ÇÇ8 9
}
ÉÉ 
filter
ÖÖ 
=
ÖÖ 
filter
ÖÖ 
.
ÖÖ 
And
ÖÖ 
(
ÖÖ  
x
ÖÖ  !
=>
ÖÖ" $
x
ÖÖ% &
.
ÖÖ& '
	DeletedAt
ÖÖ' 0
==
ÖÖ1 3
request
ÖÖ4 ;
.
ÖÖ; <
	DeletedAt
ÖÖ< E
)
ÖÖE F
;
ÖÖF G
}
ÜÜ 	
var
àà 
result
àà 
=
àà 
await
àà 
_taxRepository
àà )
.
ââ 
Search
ââ 
(
ââ 
filter
ää 
,
ää 
ordeBy
ãã 
,
ãã 
request
åå 
.
åå 
PageSize
åå  
,
åå  !
request
çç 
.
çç 
	PageIndex
çç !
)
çç! "
;
çç" #
return
èè 
new
èè 

BaseResult
èè 
<
èè 
TaxViewModel
èè *
>
èè* +
(
èè+ ,
result
êê 
.
êê 
Data
êê 
.
êê 
Select
êê 
(
êê 
x
êê  
=>
êê! #
TaxViewModel
êê$ 0
.
êê0 1

FromEntity
êê1 ;
(
êê; <
x
êê< =
)
êê= >
)
êê> ?
.
êê? @
ToList
êê@ F
(
êêF G
)
êêG H
,
êêH I
result
êêJ P
.
êêP Q
PagedResult
êêQ \
)
êê\ ]
;
êê] ^
}
ëë 
}íí ë
sD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Queries\Handlers\GetByIdTaxQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Taxes		$ )
.		) *
Queries		* 1
.		1 2
Handlers		2 :
;		: ;
public 
class "
GetByIdTaxQueryHandler #
:$ %
IRequestHandler& 5
<5 6
GetByIdTaxQuery6 E
,E F
TaxViewModelG S
>S T
{ 
private 
readonly 
ITaxRepository #
_taxRepository$ 2
;2 3
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
"
GetByIdTaxQueryHandler !
(! "
ITaxRepository 
taxRepository $
,$ %
IMessageBusClient 

messageBus $
)$ %
{ 
_taxRepository 
= 
taxRepository &
;& '
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
TaxViewModel "
>" #
Handle$ *
(* +
GetByIdTaxQuery 
request 
,  
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_taxRepository )
.) *
GetById* 1
(1 2
request2 9
.9 :
Id: <
)< =
;= >
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 C
,  C D
$str  E T
)  T U
;  U V
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 3
)%%3 4
;%%4 5
}&& 	
return(( 
TaxViewModel(( 
.(( 

FromEntity(( &
(((& '
entity((' -
)((- .
;((. /
})) 
}** ¨
cD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Queries\GetByIdTaxQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Queries* 1
;1 2
public 
class 
GetByIdTaxQuery 
: 
IRequest '
<' (
TaxViewModel( 4
>4 5
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 

GetByIdTaxQuery

 
(

 
Guid

 
id

  "
)

" #
{ 
Id 

= 
id 
; 
} 
} ı

eD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\UpdateTaxCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Commands* 2
;2 3
public 
class 
UpdateTaxCommand 
: 
IRequest  (
<( )
Guid) -
>- .
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 

decimal

 

Percentage

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
} Â2
uD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\Handlers\UpdateTaxCommandHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Taxes		$ )
.		) *
Commands		* 2
.		2 3
Handlers		3 ;
;		; <
public 
class #
UpdateTaxCommandHandler $
:% &
IRequestHandler' 6
<6 7
UpdateTaxCommand7 G
,G H
GuidI M
>M N
{ 
private 
readonly 
ITaxRepository #
_taxRepository$ 2
;2 3
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
#
UpdateTaxCommandHandler "
(" #
ITaxRepository 
taxRepository $
,$ %
IMessageBusClient 

messageBus $
,$ %
ICategoryRepository 
categoryRepository .
). /
{ 
_taxRepository 
= 
taxRepository &
;& '
_messageBus 
= 

messageBus  
;  !
_categoryRepository 
= 
categoryRepository 0
;0 1
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #
UpdateTaxCommand 
request  
,  !
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_taxRepository )
.) *
GetById* 1
(1 2
request2 9
.9 :
Id: <
)< =
;= >
if!! 

(!! 
entity!! 
==!! 
null!! 
)!! 
{"" 	
var## 
noticiation## 
=## 
new## !
NotificationError##" 3
(##3 4
$str##4 J
,##J K
$str##L b
)##b c
;##c d
var$$ 

routingKey$$ 
=$$ 
noticiation$$ (
.$$( )
GetType$$) 0
($$0 1
)$$1 2
.$$2 3
Name$$3 7
.$$7 8

ToDashCase$$8 B
($$B C
)$$C D
;$$D E
_messageBus&& 
.&& 
Publish&& 
(&&  
noticiation&&  +
,&&+ ,

routingKey&&- 7
,&&7 8
$str&&9 N
)&&N O
;&&O P
throw(( 
new(( 
NotFoundException(( '
(((' (
$str((( 4
)((4 5
;((5 6
})) 	
entity++ 
.,, 
Update,, 
(,, 
request-- 
.-- 
Name-- 
,-- 
request.. 
... 
Description.. 
,..  
request// 
.// 

Percentage// 
,// 
request00 
.00 

IdCategory00 
)00 
;00  
if22 

(22 
!22 
	Validator22 
.22 
Validate22 
(22  
new22  #
TaxValidation22$ 1
(221 2
)222 3
,223 4
entity225 ;
)22; <
)22< =
{33 	
var44 
noticiation44 
=44 
new44 !
NotificationError44" 3
(443 4
$str444 L
,44L M
$str44N f
)44f g
;44g h
var55 

routingKey55 
=55 
noticiation55 (
.55( )
GetType55) 0
(550 1
)551 2
.552 3
Name553 7
.557 8

ToDashCase558 B
(55B C
)55C D
;55D E
_messageBus77 
.77 
Publish77 
(77  
noticiation77  +
,77+ ,

routingKey77- 7
,777 8
$str779 N
)77N O
;77O P
throw99 
new99 
ValidationException99 )
(99) *
$str99* :
)99: ;
;99; <
}:: 	
var<< 
category<< 
=<< 
await<< 
_categoryRepository<< 0
.<<0 1
GetById<<1 8
(<<8 9
request<<9 @
.<<@ A

IdCategory<<A K
)<<K L
;<<L M
if>> 

(>> 
category>> 
==>> 
null>> 
)>> 
{?? 	
var@@ 
noticiation@@ 
=@@ 
new@@ !
NotificationError@@" 3
(@@3 4
$str@@4 H
,@@H I
$str@@J ^
)@@^ _
;@@_ `
varAA 

routingKeyAA 
=AA 
noticiationAA (
.AA( )
GetTypeAA) 0
(AA0 1
)AA1 2
.AA2 3
NameAA3 7
.AA7 8

ToDashCaseAA8 B
(AAB C
)AAC D
;AAD E
_messageBusCC 
.CC 
PublishCC 
(CC  
noticiationCC  +
,CC+ ,

routingKeyCC- 7
,CC7 8
$strCC9 N
)CCN O
;CCO P
throwEE 
newEE 
ValidationExceptionEE )
(EE) *
$strEE* >
)EE> ?
;EE? @
}FF 	
awaitHH 
_taxRepositoryHH 
.HH 
UpdateHH #
(HH# $
entityHH$ *
)HH* +
;HH+ ,
foreachJJ 
(JJ 
varJJ 
@eventJJ 
inJJ 
entityJJ %
.JJ% &
EventsJJ& ,
)JJ, -
{KK 	
varLL 

routingKeyLL 
=LL 
@eventLL #
.LL# $
GetTypeLL$ +
(LL+ ,
)LL, -
.LL- .
NameLL. 2
.LL2 3

ToDashCaseLL3 =
(LL= >
)LL> ?
;LL? @
_messageBusNN 
.NN 
PublishNN 
(NN  
@eventNN  &
,NN& '

routingKeyNN( 2
,NN2 3
$strNN4 A
)NNA B
;NNB C
}OO 	
returnQQ 
entityQQ 
.QQ 
IdQQ 
;QQ 
}RR 
}SS Ê
nD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\Handlers\DeleteTaxHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Commands* 2
.2 3
Handlers3 ;
;; <
public

 
class

 
DeleteTaxHandler

 
:

 
IRequestHandler

  /
<

/ 0
DeleteTaxCommand

0 @
,

@ A
Unit

B F
>

F G
{ 
private 
readonly 
ITaxRepository #
_taxRepository$ 2
;2 3
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 

DeleteTaxHandler 
( 
ITaxRepository *
taxRepository+ 8
,8 9
IMessageBusClient: K

messageBusL V
)V W
{ 
_taxRepository 
= 
taxRepository &
;& '
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" #
DeleteTaxCommand 
request  
,  !
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_taxRepository )
.) *
GetById* 1
(1 2
request2 9
.9 :
Id: <
)< =
;= >
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 J
,J K
$strL b
)b c
;c d
var 

routingKey 
= 
noticiation (
.( )
GetType) 0
(0 1
)1 2
.2 3
Name3 7
.7 8

ToDashCase8 B
(B C
)C D
;D E
_messageBus   
.   
Publish   
(    
noticiation    +
,  + ,

routingKey  - 7
,  7 8
$str  9 N
)  N O
;  O P
throw"" 
new"" 
NotFoundException"" '
(""' (
$str""( 6
)""6 7
;""7 8
}## 	
await%% 
_taxRepository%% 
.%% 
Remove%% #
(%%# $
entity%%$ *
.%%* +
Id%%+ -
)%%- .
;%%. /
return'' 
Unit'' 
.'' 
Value'' 
;'' 
}(( 
})) ˜)
uD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\Handlers\CreateTaxCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
Taxes

$ )
.

) *
Commands

* 2
.

2 3
Handlers

3 ;
;

; <
public 
class #
CreateTaxCommandHandler $
:% &
IRequestHandler' 6
<6 7
CreateTaxCommand7 G
,G H
GuidI M
>M N
{ 
private 
readonly 
ITaxRepository #
_taxRepository$ 2
;2 3
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
#
CreateTaxCommandHandler "
(" #
ITaxRepository 
taxRepository $
,$ %
IMessageBusClient 

messageBus $
,$ %
ICategoryRepository 
categoryRepository .
). /
{ 
_taxRepository 
= 
taxRepository &
;& '
_messageBus 
= 

messageBus  
;  !
_categoryRepository 
= 
categoryRepository 0
;0 1
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #
CreateTaxCommand 
request  
,  !
CancellationToken 
cancellationToken +
)+ ,
{ 
var   
entity   
=   
Tax   
.   
Create   
(    
request!! 
.!! 
Name!! 
,!! 
request"" 
."" 
Description"" 
,""  
request## 
.## 

Percentage## 
,## 
request$$ 
.$$ 

IdCategory$$ 
)$$ 
;$$  
if&& 

(&& 
!&& 
	Validator&& 
.&& 
Validate&& 
(&&  
new&&  #
TaxValidation&&$ 1
(&&1 2
)&&2 3
,&&3 4
entity&&5 ;
)&&; <
)&&< =
{'' 	
var(( 
noticiation(( 
=(( 
new(( !
NotificationError((" 3
(((3 4
$str((4 L
,((L M
$str((N f
)((f g
;((g h
var)) 

routingKey)) 
=)) 
noticiation)) (
.))( )
GetType))) 0
())0 1
)))1 2
.))2 3
Name))3 7
.))7 8

ToDashCase))8 B
())B C
)))C D
;))D E
_messageBus++ 
.++ 
Publish++ 
(++  
noticiation++  +
,+++ ,

routingKey++- 7
,++7 8
$str++9 N
)++N O
;++O P
throw-- 
new-- 
ValidationException-- )
(--) *
$str--* :
)--: ;
;--; <
}.. 	
var00 
category00 
=00 
_categoryRepository00 *
.00* +
GetById00+ 2
(002 3
entity003 9
.009 :

IdCategory00: D
)00D E
;00E F
if22 

(22 
category22 
==22 
null22 
)22 
{33 	
var44 
noticiation44 
=44 
new44 !
NotificationError44" 3
(443 4
$str444 H
,44H I
$str44J ^
)44^ _
;44_ `
var55 

routingKey55 
=55 
noticiation55 (
.55( )
GetType55) 0
(550 1
)551 2
.552 3
Name553 7
.557 8

ToDashCase558 B
(55B C
)55C D
;55D E
_messageBus77 
.77 
Publish77 
(77  
noticiation77  +
,77+ ,

routingKey77- 7
,777 8
$str779 N
)77N O
;77O P
throw99 
new99 
ValidationException99 )
(99) *
$str99* >
)99> ?
;99? @
}:: 	
await<< 
_taxRepository<< 
.<< 
Add<<  
(<<  !
entity<<! '
)<<' (
;<<( )
foreach>> 
(>> 
var>> 
@event>> 
in>> 
entity>> %
.>>% &
Events>>& ,
)>>, -
{?? 	
var@@ 

routingKey@@ 
=@@ 
@event@@ #
.@@# $
GetType@@$ +
(@@+ ,
)@@, -
.@@- .
Name@@. 2
.@@2 3

ToDashCase@@3 =
(@@= >
)@@> ?
;@@? @
_messageBusBB 
.BB 
PublishBB 
(BB  
@eventBB  &
,BB& '

routingKeyBB( 2
,BB2 3
$strBB4 A
)BBA B
;BBB C
}CC 	
returnEE 
entityEE 
.EE 
IdEE 
;EE 
}FF 
}GG ©
eD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\DeleteTaxCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Commands* 2
;2 3
public 
class 
DeleteTaxCommand 
: 
IRequest  (
<( )
Unit) -
>- .
{ 
public 

DeleteTaxCommand 
( 
Guid  
id! #
)# $
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} ·	
eD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Taxes\Commands\CreateTaxCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Commands* 2
;2 3
public 
class 
CreateTaxCommand 
: 
IRequest  (
<( )
Guid) -
>- .
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public		 

decimal		 

Percentage		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
} ¿/
jD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\ViewModels\ProductViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -

ViewModels- 7
;7 8
public 
class 
ProductViewModel 
: 
BaseViewModel  -
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
ShortDescription "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

decimal 
Price 
{ 
get 
; 
set  #
;# $
}% &
public 

decimal 
Weight 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Height 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Length 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Image 
{ 
get 
; 
set "
;" #
}$ %
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
public 

CategoryViewModel 
Category %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

Guid 
	IdCompany 
{ 
get 
;  
set! $
;$ %
}& '
public 

CompanyViewModel 
Company #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 

ProductViewModel 
( 
Guid 
id 
, 
string 
name 
, 
string 
description 
, 
string 
shortDescription 
, 
decimal 
price 
, 
decimal   
weight   
,   
decimal!! 
height!! 
,!! 
decimal"" 
length"" 
,"" 
string## 
image## 
,## 
Guid$$ 

idCategory$$ 
,$$ 
CategoryViewModel%% 
category%% !
,%%! "
Guid&& 
	idCompany&& 
,&& 
CompanyViewModel'' 
company'' 
,''  
DateTime(( 
	createdAt(( 
,(( 
DateTime)) 
?)) 
	updatedAt)) 
,)) 
DateTime** 
?** 
	deletedAt** 
)** 
:** 
base** "
(**" #
id**# %
,**% &
	createdAt**' 0
,**0 1
	updatedAt**2 ;
,**; <
	deletedAt**= F
)**F G
{++ 
Name,, 
=,, 
name,, 
;,, 
Description-- 
=-- 
description-- !
;--! "
ShortDescription.. 
=.. 
shortDescription.. +
;..+ ,
Price// 
=// 
price// 
;// 
Weight00 
=00 
weight00 
;00 
Height11 
=11 
height11 
;11 
Length22 
=22 
length22 
;22 
Image33 
=33 
image33 
;33 

IdCategory44 
=44 

idCategory44 
;44  
Category55 
=55 
category55 
;55 
	IdCompany66 
=66 
	idCompany66 
;66 
Company77 
=77 
company77 
;77 
}88 
public:: 

static:: 
ProductViewModel:: "

FromEntity::# -
(::- .
Product::. 5
entity::6 <
)::< =
{;; 
return<< 
new<< 
ProductViewModel<< #
(<<# $
entity== 
.== 
Id== 
,== 
entity>> 
.>> 
Name>> 
,>> 
entity?? 
.?? 
Description?? 
,?? 
entity@@ 
.@@ 
ShortDescription@@ #
,@@# $
entityAA 
.AA 
PriceAA 
,AA 
entityBB 
.BB 
WeightBB 
,BB 
entityCC 
.CC 
HeightCC 
,CC 
entityDD 
.DD 
LengthDD 
,DD 
entityEE 
.EE 
ImageEE 
,EE 
entityFF 
.FF 

IdCategoryFF 
,FF 
CategoryViewModelGG 
.GG 

FromEntityGG (
(GG( )
entityGG) /
.GG/ 0
CategoryGG0 8
)GG8 9
,GG9 :
entityHH 
.HH 
	IdCompanyHH 
,HH 
CompanyViewModelII 
.II 

FromEntityII '
(II' (
entityII( .
.II. /
CompanyII/ 6
)II6 7
,II7 8
entityJJ 
.JJ 
	CreatedAtJJ 
,JJ 
entityKK 
.KK 
	UpdatedAtKK 
,KK 
entityLL 
.LL 
	DeletedAtLL 
)LL 
;LL 
}MM 
}NN ±
iD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Queries\SearchProductQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Queries- 4
;4 5
public 
class 
SearchProductQuery 
:  !

BaseSearch" ,
,, -
IRequest. 6
<6 7

BaseResult7 A
<A B
ProductViewModelB R
>R S
>S T
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
string

' -
.

- .
Empty

. 3
;

3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
ShortDescription "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 

decimal 
Price 
{ 
get 
; 
set  #
;# $
}% &
public 

decimal 
Weight 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Height 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Length 
{ 
get 
;  
set! $
;$ %
}& '
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
public 

Guid 
	IdCompany 
{ 
get 
;  
set! $
;$ %
}& '
} ôë
yD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Queries\Handlers\SearchProductQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Products		$ ,
.		, -
Queries		- 4
.		4 5
Handlers		5 =
;		= >
public 
class %
SearchProductQueryHandler &
:' (
IRequestHandler) 8
<8 9
SearchProductQuery9 K
,K L

BaseResultM W
<W X
ProductViewModelX h
>h i
>i j
{ 
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
public 
%
SearchProductQueryHandler $
($ %
IProductRepository% 7
productRepository8 I
)I J
{ 
_productRepository 
= 
productRepository .
;. /
} 
public 

async 
Task 
< 

BaseResult  
<  !
ProductViewModel! 1
>1 2
>2 3
Handle4 :
(: ;
SearchProductQuery 
request "
," #
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
Product 
,  
bool! %
>% &
>& '
?' (
filter) /
=0 1
null2 6
;6 7
Func 
< 

IQueryable 
< 
Product 
>  
,  !
IOrderedQueryable" 3
<3 4
Product4 ;
>; <
>< =
?= >
ordeBy? E
=F G
nullH L
;L M
if 

( 
! 
string 
. 
IsNullOrWhiteSpace &
(& '
request' .
.. /
Name/ 3
)3 4
)4 5
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Name' +
==, .
request/ 6
.6 7
Name7 ;
); <
;< =
} 	
if   

(   
!   
string   
.   
IsNullOrWhiteSpace   &
(  & '
request  ' .
.  . /
Description  / :
)  : ;
)  ; <
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
Product$$. 5
>$$5 6
($$6 7
true$$7 ;
)$$; <
;$$< =
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
Description''' 2
==''3 5
request''6 =
.''= >
Description''> I
)''I J
;''J K
}(( 	
if** 

(** 
!** 
string** 
.** 
IsNullOrWhiteSpace** &
(**& '
request**' .
.**. /
ShortDescription**/ ?
)**? @
)**@ A
{++ 	
if,, 
(,, 
filter,, 
==,, 
null,, 
),, 
{-- 
filter.. 
=.. 
PredicateBuilder.. )
...) *
New..* -
<..- .
Product... 5
>..5 6
(..6 7
true..7 ;
)..; <
;..< =
}// 
filter11 
=11 
filter11 
.11 
And11 
(11  
x11  !
=>11" $
x11% &
.11& '
ShortDescription11' 7
==118 :
request11; B
.11B C
ShortDescription11C S
)11S T
;11T U
}22 	
if44 

(44 
request44 
.44 
Price44 
!=44 
default44 $
)44$ %
{55 	
if66 
(66 
filter66 
==66 
null66 
)66 
{77 
filter88 
=88 
PredicateBuilder88 )
.88) *
New88* -
<88- .
Product88. 5
>885 6
(886 7
true887 ;
)88; <
;88< =
}99 
filter;; 
=;; 
filter;; 
.;; 
And;; 
(;;  
x;;  !
=>;;" $
x;;% &
.;;& '
Price;;' ,
==;;- /
request;;0 7
.;;7 8
Price;;8 =
);;= >
;;;> ?
}<< 	
if>> 

(>> 
request>> 
.>> 
Weight>> 
!=>> 
default>> %
)>>% &
{?? 	
if@@ 
(@@ 
filter@@ 
==@@ 
null@@ 
)@@ 
{AA 
filterBB 
=BB 
PredicateBuilderBB )
.BB) *
NewBB* -
<BB- .
ProductBB. 5
>BB5 6
(BB6 7
trueBB7 ;
)BB; <
;BB< =
}CC 
filterEE 
=EE 
filterEE 
.EE 
AndEE 
(EE  
xEE  !
=>EE" $
xEE% &
.EE& '
WeightEE' -
==EE. 0
requestEE1 8
.EE8 9
WeightEE9 ?
)EE? @
;EE@ A
}FF 	
ifHH 

(HH 
requestHH 
.HH 
HeightHH 
!=HH 
defaultHH %
)HH% &
{II 	
ifJJ 
(JJ 
filterJJ 
==JJ 
nullJJ 
)JJ 
{KK 
filterLL 
=LL 
PredicateBuilderLL )
.LL) *
NewLL* -
<LL- .
ProductLL. 5
>LL5 6
(LL6 7
trueLL7 ;
)LL; <
;LL< =
}MM 
filterOO 
=OO 
filterOO 
.OO 
AndOO 
(OO  
xOO  !
=>OO" $
xOO% &
.OO& '
HeightOO' -
==OO. 0
requestOO1 8
.OO8 9
HeightOO9 ?
)OO? @
;OO@ A
}PP 	
ifRR 

(RR 
requestRR 
.RR 
LengthRR 
!=RR 
defaultRR %
)RR% &
{SS 	
ifTT 
(TT 
filterTT 
==TT 
nullTT 
)TT 
{UU 
filterVV 
=VV 
PredicateBuilderVV )
.VV) *
NewVV* -
<VV- .
ProductVV. 5
>VV5 6
(VV6 7
trueVV7 ;
)VV; <
;VV< =
}WW 
filterYY 
=YY 
filterYY 
.YY 
AndYY 
(YY  
xYY  !
=>YY" $
xYY% &
.YY& '
LengthYY' -
==YY. 0
requestYY1 8
.YY8 9
LengthYY9 ?
)YY? @
;YY@ A
}ZZ 	
if\\ 

(\\ 
!\\ 
string\\ 
.\\ 
IsNullOrWhiteSpace\\ &
(\\& '
request\\' .
.\\. /
Order\\/ 4
)\\4 5
)\\5 6
{]] 	
switch^^ 
(^^ 
request^^ 
.^^ 
Order^^ !
)^^! "
{__ 
case`` 
$str`` 
:`` 
ordeByaa 
=aa 
xaa 
=>aa !
xaa" #
.aa# $
OrderByaa$ +
(aa+ ,
naa, -
=>aa. 0
naa1 2
.aa2 3
Idaa3 5
)aa5 6
;aa6 7
breakbb 
;bb 
casedd 
$strdd 
:dd 
ordeByee 
=ee 
xee 
=>ee !
xee" #
.ee# $
OrderByee$ +
(ee+ ,
nee, -
=>ee. 0
nee1 2
.ee2 3
Nameee3 7
)ee7 8
;ee8 9
breakff 
;ff 
casehh 
$strhh "
:hh" #
ordeByii 
=ii 
xii 
=>ii !
xii" #
.ii# $
OrderByii$ +
(ii+ ,
nii, -
=>ii. 0
nii1 2
.ii2 3
Descriptionii3 >
)ii> ?
;ii? @
breakjj 
;jj 
casell 
$strll '
:ll' (
ordeBymm 
=mm 
xmm 
=>mm !
xmm" #
.mm# $
OrderBymm$ +
(mm+ ,
nmm, -
=>mm. 0
nmm1 2
.mm2 3
ShortDescriptionmm3 C
)mmC D
;mmD E
breaknn 
;nn 
casepp 
$strpp 
:pp 
ordeByqq 
=qq 
xqq 
=>qq !
xqq" #
.qq# $
OrderByqq$ +
(qq+ ,
nqq, -
=>qq. 0
nqq1 2
.qq2 3
Priceqq3 8
)qq8 9
;qq9 :
breakrr 
;rr 
casett 
$strtt 
:tt 
ordeByuu 
=uu 
xuu 
=>uu !
xuu" #
.uu# $
OrderByuu$ +
(uu+ ,
nuu, -
=>uu. 0
nuu1 2
.uu2 3
Weightuu3 9
)uu9 :
;uu: ;
breakvv 
;vv 
casexx 
$strxx 
:xx 
ordeByyy 
=yy 
xyy 
=>yy !
xyy" #
.yy# $
OrderByyy$ +
(yy+ ,
nyy, -
=>yy. 0
nyy1 2
.yy2 3
Heightyy3 9
)yy9 :
;yy: ;
breakzz 
;zz 
case|| 
$str|| 
:|| 
ordeBy}} 
=}} 
x}} 
=>}} !
x}}" #
.}}# $
OrderBy}}$ +
(}}+ ,
n}}, -
=>}}. 0
n}}1 2
.}}2 3
Length}}3 9
)}}9 :
;}}: ;
break~~ 
;~~ 
case
ÄÄ 
$str
ÄÄ  
:
ÄÄ  !
ordeBy
ÅÅ 
=
ÅÅ 
x
ÅÅ 
=>
ÅÅ !
x
ÅÅ" #
.
ÅÅ# $
OrderBy
ÅÅ$ +
(
ÅÅ+ ,
n
ÅÅ, -
=>
ÅÅ. 0
n
ÅÅ1 2
.
ÅÅ2 3
	CreatedAt
ÅÅ3 <
)
ÅÅ< =
;
ÅÅ= >
break
ÇÇ 
;
ÇÇ 
case
ÑÑ 
$str
ÑÑ  
:
ÑÑ  !
ordeBy
ÖÖ 
=
ÖÖ 
x
ÖÖ 
=>
ÖÖ !
x
ÖÖ" #
.
ÖÖ# $
OrderBy
ÖÖ$ +
(
ÖÖ+ ,
n
ÖÖ, -
=>
ÖÖ. 0
n
ÖÖ1 2
.
ÖÖ2 3
	UpdatedAt
ÖÖ3 <
)
ÖÖ< =
;
ÖÖ= >
break
ÜÜ 
;
ÜÜ 
case
àà 
$str
àà  
:
àà  !
ordeBy
ââ 
=
ââ 
x
ââ 
=>
ââ !
x
ââ" #
.
ââ# $
OrderBy
ââ$ +
(
ââ+ ,
n
ââ, -
=>
ââ. 0
n
ââ1 2
.
ââ2 3
	DeletedAt
ââ3 <
)
ââ< =
;
ââ= >
break
ää 
;
ää 
default
åå 
:
åå 
ordeBy
çç 
=
çç 
x
çç 
=>
çç !
x
çç" #
.
çç# $
OrderBy
çç$ +
(
çç+ ,
n
çç, -
=>
çç. 0
n
çç1 2
.
çç2 3
Id
çç3 5
)
çç5 6
;
çç6 7
break
éé 
;
éé 
}
èè 
}
êê 	
if
íí 

(
íí 
request
íí 
.
íí 

IdCategory
íí 
!=
íí !
Guid
íí" &
.
íí& '
Empty
íí' ,
)
íí, -
{
ìì 	
if
îî 
(
îî 
filter
îî 
==
îî 
null
îî 
)
îî 
{
ïï 
filter
ññ 
=
ññ 
PredicateBuilder
ññ )
.
ññ) *
New
ññ* -
<
ññ- .
Product
ññ. 5
>
ññ5 6
(
ññ6 7
true
ññ7 ;
)
ññ; <
;
ññ< =
}
óó 
filter
ôô 
=
ôô 
filter
ôô 
.
ôô 
And
ôô 
(
ôô  
x
ôô  !
=>
ôô" $
x
ôô% &
.
ôô& '

IdCategory
ôô' 1
==
ôô2 4
request
ôô5 <
.
ôô< =

IdCategory
ôô= G
)
ôôG H
;
ôôH I
}
öö 	
if
úú 

(
úú 
request
úú 
.
úú 
	IdCompany
úú 
!=
úú  
Guid
úú! %
.
úú% &
Empty
úú& +
)
úú+ ,
{
ùù 	
if
ûû 
(
ûû 
filter
ûû 
==
ûû 
null
ûû 
)
ûû 
{
üü 
filter
†† 
=
†† 
PredicateBuilder
†† )
.
††) *
New
††* -
<
††- .
Product
††. 5
>
††5 6
(
††6 7
true
††7 ;
)
††; <
;
††< =
}
°° 
filter
££ 
=
££ 
filter
££ 
.
££ 
And
££ 
(
££  
x
££  !
=>
££" $
x
££% &
.
££& '
	IdCompany
££' 0
==
££1 3
request
££4 ;
.
££; <
	IdCompany
££< E
)
££E F
;
££F G
}
§§ 	
if
¶¶ 

(
¶¶ 
request
¶¶ 
.
¶¶ 
Id
¶¶ 
!=
¶¶ 
Guid
¶¶ 
.
¶¶ 
Empty
¶¶ $
)
¶¶$ %
{
ßß 	
if
®® 
(
®® 
filter
®® 
==
®® 
null
®® 
)
®® 
{
©© 
filter
™™ 
=
™™ 
PredicateBuilder
™™ )
.
™™) *
New
™™* -
<
™™- .
Product
™™. 5
>
™™5 6
(
™™6 7
true
™™7 ;
)
™™; <
;
™™< =
}
´´ 
filter
≠≠ 
=
≠≠ 
filter
≠≠ 
.
≠≠ 
And
≠≠ 
(
≠≠  
x
≠≠  !
=>
≠≠" $
x
≠≠% &
.
≠≠& '
Id
≠≠' )
==
≠≠* ,
request
≠≠- 4
.
≠≠4 5
Id
≠≠5 7
)
≠≠7 8
;
≠≠8 9
}
ÆÆ 	
if
∞∞ 

(
∞∞ 
request
∞∞ 
.
∞∞ 
	CreatedAt
∞∞ 
!=
∞∞  
default
∞∞! (
)
∞∞( )
{
±± 	
if
≤≤ 
(
≤≤ 
filter
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤ 
{
≥≥ 
filter
¥¥ 
=
¥¥ 
PredicateBuilder
¥¥ )
.
¥¥) *
New
¥¥* -
<
¥¥- .
Product
¥¥. 5
>
¥¥5 6
(
¥¥6 7
true
¥¥7 ;
)
¥¥; <
;
¥¥< =
}
µµ 
filter
∑∑ 
=
∑∑ 
filter
∑∑ 
.
∑∑ 
And
∑∑ 
(
∑∑  
x
∑∑  !
=>
∑∑" $
x
∑∑% &
.
∑∑& '
	CreatedAt
∑∑' 0
==
∑∑1 3
request
∑∑4 ;
.
∑∑; <
	CreatedAt
∑∑< E
)
∑∑E F
;
∑∑F G
}
∏∏ 	
if
∫∫ 

(
∫∫ 
request
∫∫ 
.
∫∫ 
	UpdatedAt
∫∫ 
!=
∫∫  
default
∫∫! (
)
∫∫( )
{
ªª 	
if
ºº 
(
ºº 
filter
ºº 
==
ºº 
null
ºº 
)
ºº 
{
ΩΩ 
filter
ææ 
=
ææ 
PredicateBuilder
ææ )
.
ææ) *
New
ææ* -
<
ææ- .
Product
ææ. 5
>
ææ5 6
(
ææ6 7
true
ææ7 ;
)
ææ; <
;
ææ< =
}
øø 
filter
¡¡ 
=
¡¡ 
filter
¡¡ 
.
¡¡ 
And
¡¡ 
(
¡¡  
x
¡¡  !
=>
¡¡" $
x
¡¡% &
.
¡¡& '
	UpdatedAt
¡¡' 0
==
¡¡1 3
request
¡¡4 ;
.
¡¡; <
	UpdatedAt
¡¡< E
)
¡¡E F
;
¡¡F G
}
¬¬ 	
if
ƒƒ 

(
ƒƒ 
request
ƒƒ 
.
ƒƒ 
	DeletedAt
ƒƒ 
.
ƒƒ 
HasValue
ƒƒ &
||
ƒƒ' )
request
ƒƒ* 1
.
ƒƒ1 2
	DeletedAt
ƒƒ2 ;
!=
ƒƒ< >
default
ƒƒ? F
)
ƒƒF G
{
≈≈ 	
if
∆∆ 
(
∆∆ 
filter
∆∆ 
==
∆∆ 
null
∆∆ 
)
∆∆ 
{
«« 
filter
»» 
=
»» 
PredicateBuilder
»» )
.
»») *
New
»»* -
<
»»- .
Product
»». 5
>
»»5 6
(
»»6 7
true
»»7 ;
)
»»; <
;
»»< =
}
…… 
filter
ÀÀ 
=
ÀÀ 
filter
ÀÀ 
.
ÀÀ 
And
ÀÀ 
(
ÀÀ  
x
ÀÀ  !
=>
ÀÀ" $
x
ÀÀ% &
.
ÀÀ& '
	DeletedAt
ÀÀ' 0
==
ÀÀ1 3
request
ÀÀ4 ;
.
ÀÀ; <
	DeletedAt
ÀÀ< E
)
ÀÀE F
;
ÀÀF G
}
ÃÃ 	
var
ŒŒ 
result
ŒŒ 
=
ŒŒ 
await
ŒŒ  
_productRepository
ŒŒ -
.
œœ 
Search
œœ 
(
œœ 
filter
–– 
,
–– 
ordeBy
—— 
,
—— 
request
““ 
.
““ 
PageSize
““  
,
““  !
request
”” 
.
”” 
	PageIndex
”” !
)
””! "
;
””" #
return
’’ 
new
’’ 

BaseResult
’’ 
<
’’ 
ProductViewModel
’’ .
>
’’. /
(
’’/ 0
result
÷÷ 
.
÷÷ 
Data
÷÷ 
.
÷÷ 
Select
÷÷ 
(
÷÷ 
x
÷÷  
=>
÷÷! #
ProductViewModel
÷÷$ 4
.
÷÷4 5

FromEntity
÷÷5 ?
(
÷÷? @
x
÷÷@ A
)
÷÷A B
)
÷÷B C
.
÷÷C D
ToList
÷÷D J
(
÷÷J K
)
÷÷K L
,
÷÷L M
result
÷÷N T
.
÷÷T U
PagedResult
÷÷U `
)
÷÷` a
;
÷÷a b
}
◊◊ 
}ÿÿ ”
zD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Queries\Handlers\GetByIdProductQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Products		$ ,
.		, -
Queries		- 4
.		4 5
Handlers		5 =
;		= >
public 
class &
GetByIdProductQueryHandler '
:( )
IRequestHandler* 9
<9 :
GetByIdProductQuery: M
,M N
ProductViewModelO _
>_ `
{ 
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
&
GetByIdProductQueryHandler %
(% &
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
ProductViewModel &
>& '
Handle( .
(. /
GetByIdProductQuery 
request #
,# $
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_productRepository -
.- .
GetById. 5
(5 6
request6 =
.= >
Id> @
)@ A
;A B
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 G
,  G H
$str  I \
)  \ ]
;  ] ^
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 3
)%%3 4
;%%4 5
}&& 	
return(( 
ProductViewModel(( 
.((  

FromEntity((  *
(((* +
entity((+ 1
)((1 2
;((2 3
})) 
}** ¬
jD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Queries\GetByIdProductQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Queries- 4
;4 5
public 
class 
GetByIdProductQuery  
:! "
IRequest# +
<+ ,
ProductViewModel, <
>< =
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 

GetByIdProductQuery

 
(

 
Guid

 #
id

$ &
)

& '
{ 
Id 

= 
id 
; 
} 
} À
hD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\UpdateTaxCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Commands- 5
;5 6
public 
class  
UpdateProductCommand !
:" #
IRequest$ ,
<, -
Guid- 1
>1 2
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 

string

 
ShortDescription

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
=

1 2
string

3 9
.

9 :
Empty

: ?
;

? @
public 

decimal 
Price 
{ 
get 
; 
set  #
;# $
}% &
public 

decimal 
Weight 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Height 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Length 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Image 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
public 

Guid 
	IdCompany 
{ 
get 
;  
set! $
;$ %
}& '
} åB
|D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\Handlers\UpdateProductCommandHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Products		$ ,
.		, -
Commands		- 5
.		5 6
Handlers		6 >
;		> ?
public 
class '
UpdateProductCommandHandler (
:) *
IRequestHandler+ :
<: ; 
UpdateProductCommand; O
,O P
GuidQ U
>U V
{ 
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
UpdateProductCommandHandler &
(& '
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
,$ %
ICategoryRepository 
categoryRepository .
,. /
ICompanyRepository 
companyRepository ,
), -
{ 
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
_categoryRepository 
= 
categoryRepository 0
;0 1
_companyRepository 
= 
companyRepository .
;. /
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" # 
UpdateProductCommand 
request $
,$ %
CancellationToken   
cancellationToken   +
)  + ,
{!! 
var"" 
entity"" 
="" 
await"" 
_productRepository"" -
.""- .
GetById"". 5
(""5 6
request""6 =
.""= >
Id""> @
)""@ A
;""A B
if$$ 

($$ 
entity$$ 
==$$ 
null$$ 
)$$ 
{%% 	
var&& 
noticiation&& 
=&& 
new&& !
NotificationError&&" 3
(&&3 4
$str&&4 N
,&&N O
$str&&P j
)&&j k
;&&k l
var'' 

routingKey'' 
='' 
noticiation'' (
.''( )
GetType'') 0
(''0 1
)''1 2
.''2 3
Name''3 7
.''7 8

ToDashCase''8 B
(''B C
)''C D
;''D E
_messageBus)) 
.)) 
Publish)) 
())  
noticiation))  +
,))+ ,

routingKey))- 7
,))7 8
$str))9 N
)))N O
;))O P
throw++ 
new++ 
NotFoundException++ '
(++' (
$str++( 4
)++4 5
;++5 6
},, 	
entity.. 
... 
Update.. 
(.. 
request// 
.// 
Name// 
,// 
request00 
.00 
Description00  
,00  !
request11 
.11 
ShortDescription11 %
,11% &
request22 
.22 
Price22 
,22 
request33 
.33 
Weight33 
,33 
request44 
.44 
Height44 
,44 
request55 
.55 
Length55 
,55 
request66 
.66 
Image66 
,66 
request77 
.77 

IdCategory77 
,77  
request88 
.88 
	IdCompany88 
)88 
;88  
if:: 

(:: 
!:: 
	Validator:: 
.:: 
Validate:: 
(::  
new::  #
ProductValidation::$ 5
(::5 6
)::6 7
,::7 8
entity::9 ?
)::? @
)::@ A
{;; 	
var<< 
noticiation<< 
=<< 
new<< !
NotificationError<<" 3
(<<3 4
$str<<4 P
,<<P Q
$str<<R n
)<<n o
;<<o p
var== 

routingKey== 
=== 
noticiation== (
.==( )
GetType==) 0
(==0 1
)==1 2
.==2 3
Name==3 7
.==7 8

ToDashCase==8 B
(==B C
)==C D
;==D E
_messageBus?? 
.?? 
Publish?? 
(??  
noticiation??  +
,??+ ,

routingKey??- 7
,??7 8
$str??9 N
)??N O
;??O P
throwAA 
newAA 
ValidationExceptionAA )
(AA) *
$strAA* :
)AA: ;
;AA; <
}BB 	
varDD 
categoryDD 
=DD 
awaitDD 
_categoryRepositoryDD 0
.DD0 1
GetByIdDD1 8
(DD8 9
requestDD9 @
.DD@ A

IdCategoryDDA K
)DDK L
;DDL M
ifFF 

(FF 
categoryFF 
==FF 
nullFF 
)FF 
{GG 	
varHH 
noticiationHH 
=HH 
newHH !
NotificationErrorHH" 3
(HH3 4
$strHH4 H
,HHH I
$strHHJ ^
)HH^ _
;HH_ `
varII 

routingKeyII 
=II 
noticiationII (
.II( )
GetTypeII) 0
(II0 1
)II1 2
.II2 3
NameII3 7
.II7 8

ToDashCaseII8 B
(IIB C
)IIC D
;IID E
_messageBusKK 
.KK 
PublishKK 
(KK  
noticiationKK  +
,KK+ ,

routingKeyKK- 7
,KK7 8
$strKK9 N
)KKN O
;KKO P
throwMM 
newMM 
NotFoundExceptionMM '
(MM' (
$strMM( <
)MM< =
;MM= >
}NN 	
varPP 
companyPP 
=PP 
awaitPP 
_companyRepositoryPP .
.PP. /
GetByIdPP/ 6
(PP6 7
requestPP7 >
.PP> ?
	IdCompanyPP? H
)PPH I
;PPI J
ifRR 

(RR 
companyRR 
==RR 
nullRR 
)RR 
{SS 	
varTT 
noticiationTT 
=TT 
newTT !
NotificationErrorTT" 3
(TT3 4
$strTT4 G
,TTG H
$strTTI \
)TT\ ]
;TT] ^
varUU 

routingKeyUU 
=UU 
noticiationUU (
.UU( )
GetTypeUU) 0
(UU0 1
)UU1 2
.UU2 3
NameUU3 7
.UU7 8

ToDashCaseUU8 B
(UUB C
)UUC D
;UUD E
_messageBusWW 
.WW 
PublishWW 
(WW  
noticiationWW  +
,WW+ ,

routingKeyWW- 7
,WW7 8
$strWW9 N
)WWN O
;WWO P
throwYY 
newYY 
NotFoundExceptionYY '
(YY' (
$strYY( ;
)YY; <
;YY< =
}ZZ 	
await\\ 
_productRepository\\  
.\\  !
Update\\! '
(\\' (
entity\\( .
)\\. /
;\\/ 0
foreach^^ 
(^^ 
var^^ 
@event^^ 
in^^ 
entity^^ %
.^^% &
Events^^& ,
)^^, -
{__ 	
var`` 

routingKey`` 
=`` 
@event`` #
.``# $
GetType``$ +
(``+ ,
)``, -
.``- .
Name``. 2
.``2 3

ToDashCase``3 =
(``= >
)``> ?
;``? @
_messageBusbb 
.bb 
Publishbb 
(bb  
@eventbb  &
,bb& '

routingKeybb( 2
,bb2 3
$strbb4 E
)bbE F
;bbF G
}cc 	
returnee 
entityee 
.ee 
Idee 
;ee 
}ff 
}gg †
uD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\Handlers\DeleteProductHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Commands- 5
.5 6
Handlers6 >
;> ?
public

 
class

  
DeleteProductHandler

 !
:

" #
IRequestHandler

$ 3
<

3 4 
DeleteProductCommand

4 H
,

H I
Unit

J N
>

N O
{ 
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
 
DeleteProductHandler 
(  
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" # 
DeleteProductCommand 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_productRepository -
.- .
GetById. 5
(5 6
request6 =
.= >
Id> @
)@ A
;A B
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 N
,N O
$strP j
)j k
;k l
var   

routingKey   
=   
noticiation   (
.  ( )
GetType  ) 0
(  0 1
)  1 2
.  2 3
Name  3 7
.  7 8

ToDashCase  8 B
(  B C
)  C D
;  D E
_messageBus"" 
."" 
Publish"" 
(""  
noticiation""  +
,""+ ,

routingKey""- 7
,""7 8
$str""9 N
)""N O
;""O P
throw$$ 
new$$ 
NotFoundException$$ '
($$' (
$str$$( 6
)$$6 7
;$$7 8
}%% 	
await'' 
_productRepository''  
.''  !
Remove''! '
(''' (
entity''( .
.''. /
Id''/ 1
)''1 2
;''2 3
return)) 
Unit)) 
.)) 
Value)) 
;)) 
}** 
}++ Ø9
|D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\Handlers\CreateProductCommandHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Taxes$ )
.) *
Commands* 2
.2 3
Handlers3 ;
;; <
public 
class '
CreateProductCommandHandler (
:) *
IRequestHandler+ :
<: ; 
CreateProductCommand; O
,O P
GuidQ U
>U V
{ 
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
CreateProductCommandHandler &
(& '
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
,$ %
ICategoryRepository 
categoryRepository .
,. /
ICompanyRepository 
companyRepository ,
), -
{ 
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
_categoryRepository 
= 
categoryRepository 0
;0 1
_companyRepository 
= 
companyRepository .
;. /
} 
public   

async   
Task   
<   
Guid   
>   
Handle   "
(  " # 
CreateProductCommand!! 
request!! $
,!!$ %
CancellationToken"" 
cancellationToken"" +
)""+ ,
{## 
var$$ 
entity$$ 
=$$ 
Product$$ 
.$$ 
Create$$ #
($$# $
request%% 
.%% 
Name%% 
,%% 
request&& 
.&& 
Description&& 
,&&  
request'' 
.'' 
ShortDescription'' $
,''$ %
request(( 
.(( 
Price(( 
,(( 
request)) 
.)) 
Weight)) 
,)) 
request** 
.** 
Height** 
,** 
request++ 
.++ 
Length++ 
,++ 
request,, 
.,, 
Image,, 
,,, 
request-- 
.-- 

IdCategory-- 
,-- 
request.. 
... 
	IdCompany.. 
).. 
;.. 
if00 

(00 
!00 
	Validator00 
.00 
Validate00 
(00  
new00  #
ProductValidation00$ 5
(005 6
)006 7
,007 8
entity009 ?
)00? @
)00@ A
{11 	
var22 
noticiation22 
=22 
new22 !
NotificationError22" 3
(223 4
$str224 P
,22P Q
$str22R n
)22n o
;22o p
var33 

routingKey33 
=33 
noticiation33 (
.33( )
GetType33) 0
(330 1
)331 2
.332 3
Name333 7
.337 8

ToDashCase338 B
(33B C
)33C D
;33D E
_messageBus55 
.55 
Publish55 
(55  
noticiation55  +
,55+ ,

routingKey55- 7
,557 8
$str559 N
)55N O
;55O P
throw77 
new77 
ValidationException77 )
(77) *
$str77* :
)77: ;
;77; <
}88 	
var:: 
category:: 
=:: 
await:: 
_categoryRepository:: 0
.::0 1
GetById::1 8
(::8 9
request::9 @
.::@ A

IdCategory::A K
)::K L
;::L M
if<< 

(<< 
category<< 
==<< 
null<< 
)<< 
{== 	
var>> 
noticiation>> 
=>> 
new>> !
NotificationError>>" 3
(>>3 4
$str>>4 H
,>>H I
$str>>J ^
)>>^ _
;>>_ `
var?? 

routingKey?? 
=?? 
noticiation?? (
.??( )
GetType??) 0
(??0 1
)??1 2
.??2 3
Name??3 7
.??7 8

ToDashCase??8 B
(??B C
)??C D
;??D E
_messageBusAA 
.AA 
PublishAA 
(AA  
noticiationAA  +
,AA+ ,

routingKeyAA- 7
,AA7 8
$strAA9 N
)AAN O
;AAO P
throwCC 
newCC 
NotFoundExceptionCC '
(CC' (
$strCC( <
)CC< =
;CC= >
}DD 	
varFF 
companyFF 
=FF 
awaitFF 
_companyRepositoryFF .
.FF. /
GetByIdFF/ 6
(FF6 7
requestFF7 >
.FF> ?
	IdCompanyFF? H
)FFH I
;FFI J
ifHH 

(HH 
companyHH 
==HH 
nullHH 
)HH 
{II 	
varJJ 
noticiationJJ 
=JJ 
newJJ !
NotificationErrorJJ" 3
(JJ3 4
$strJJ4 G
,JJG H
$strJJI \
)JJ\ ]
;JJ] ^
varKK 

routingKeyKK 
=KK 
noticiationKK (
.KK( )
GetTypeKK) 0
(KK0 1
)KK1 2
.KK2 3
NameKK3 7
.KK7 8

ToDashCaseKK8 B
(KKB C
)KKC D
;KKD E
_messageBusMM 
.MM 
PublishMM 
(MM  
noticiationMM  +
,MM+ ,

routingKeyMM- 7
,MM7 8
$strMM9 N
)MMN O
;MMO P
throwOO 
newOO 
NotFoundExceptionOO '
(OO' (
$strOO( ;
)OO; <
;OO< =
}PP 	
awaitRR 
_productRepositoryRR  
.RR  !
AddRR! $
(RR$ %
entityRR% +
)RR+ ,
;RR, -
foreachTT 
(TT 
varTT 
@eventTT 
inTT 
entityTT %
.TT% &
EventsTT& ,
)TT, -
{UU 	
varVV 

routingKeyVV 
=VV 
@eventVV #
.VV# $
GetTypeVV$ +
(VV+ ,
)VV, -
.VV- .
NameVV. 2
.VV2 3

ToDashCaseVV3 =
(VV= >
)VV> ?
;VV? @
_messageBusXX 
.XX 
PublishXX 
(XX  
@eventXX  &
,XX& '

routingKeyXX( 2
,XX2 3
$strXX4 E
)XXE F
;XXF G
}YY 	
return[[ 
entity[[ 
.[[ 
Id[[ 
;[[ 
}\\ 
}]] ª
lD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\DeleteProductCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Commands- 5
;5 6
public 
class  
DeleteProductCommand !
:" #
IRequest$ ,
<, -
Unit- 1
>1 2
{ 
public 
 
DeleteProductCommand 
(  
Guid  $
id% '
)' (
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} ª
lD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Products\Commands\CreateProductCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Products$ ,
., -
Commands- 5
;5 6
public 
class  
CreateProductCommand !
:" #
IRequest$ ,
<, -
Guid- 1
>1 2
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public		 

string		 
ShortDescription		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
=		1 2
string		3 9
.		9 :
Empty		: ?
;		? @
public

 

decimal

 
Price

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 

decimal 
Weight 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Height 
{ 
get 
;  
set! $
;$ %
}& '
public 

decimal 
Length 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Image 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

Guid 

IdCategory 
{ 
get  
;  !
set" %
;% &
}' (
public 

Guid 
	IdCompany 
{ 
get 
;  
set! $
;$ %
}& '
} Æ
oD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\ViewModels\InventoryViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0

ViewModels0 :
;: ;
public 
class 
InventoryViewModel 
:  !
BaseViewModel" /
{ 
public		 

int		 
Quantity		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
public

 

DateTime

 
	DateOrder

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

Guid 
	IdProduct 
{ 
get 
;  
set! $
;$ %
}& '
public 

ProductViewModel 
Product #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 

InventoryViewModel 
( 
Guid 
id 
, 
int 
quantity 
, 
DateTime 
	dateOrder 
, 
Guid 
	idProduct 
, 
ProductViewModel 
product  
,  !
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime 
? 
	deletedAt 
) 	
:
 
base 
( 
id 
, 
	createdAt 
, 
	updatedAt  )
,) *
	deletedAt+ 4
)4 5
{ 
Quantity 
= 
quantity 
; 
	DateOrder 
= 
	dateOrder 
; 
	IdProduct 
= 
	idProduct 
; 
Product 
= 
product 
; 
} 
public   

static   
InventoryViewModel   $

FromEntity  % /
(  / 0
	Inventory  0 9
entity  : @
)  @ A
{!! 
return"" 
new"" 
InventoryViewModel"" %
(""% &
entity## 
.## 
Id## 
,## 
entity$$ 
.$$ 
Quantity$$ 
,$$ 
entity%% 
.%% 
	DateOrder%% 
,%% 
entity&& 
.&& 
	IdProduct&& 
,&& 
ProductViewModel'' 
.'' 

FromEntity'' '
(''' (
entity''( .
.''. /
Product''/ 6
)''6 7
,''7 8
entity(( 
.(( 
	CreatedAt(( 
,(( 
entity)) 
.)) 
	UpdatedAt)) 
,)) 
entity** 
.** 
	DeletedAt** 
)** 
;** 
}++ 
},, ó
nD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Queries\SearchInventoryQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Queries0 7
;7 8
public 
class  
SearchInventoryQuery !
:" #

BaseSearch$ .
,. /
IRequest0 8
<8 9

BaseResult9 C
<C D
InventoryViewModelD V
>V W
>W X
{		 
public

 

int

 
Quantity

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
public 

DateTime 
	DateOrder 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 
	IdProduct 
{ 
get 
;  
set! $
;$ %
}& '
} °W
~D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Queries\Handlers\SearchInventoryQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Inventories		$ /
.		/ 0
Queries		0 7
.		7 8
Handlers		8 @
;		@ A
public 
class '
SearchInventoryQueryHandler (
:) *
IRequestHandler+ :
<: ; 
SearchInventoryQuery; O
,O P

BaseResultQ [
<[ \
InventoryViewModel\ n
>n o
>o p
{ 
private 
readonly  
IInventoryRepository ) 
_inventoryRepository* >
;> ?
public 
'
SearchInventoryQueryHandler &
(& ' 
IInventoryRepository' ;
inventoryRepository< O
)O P
{  
_inventoryRepository 
= 
inventoryRepository 2
;2 3
} 
public 

async 
Task 
< 

BaseResult  
<  !
InventoryViewModel! 3
>3 4
>4 5
Handle6 <
(< = 
SearchInventoryQuery 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
	Inventory !
,! "
bool# '
>' (
>( )
?) *
filter+ 1
=2 3
null4 8
;8 9
Func 
< 

IQueryable 
< 
	Inventory !
>! "
," #
IOrderedQueryable$ 5
<5 6
	Inventory6 ?
>? @
>@ A
?A B
ordeByC I
=J K
nullL P
;P Q
if 

( 
request 
. 
Quantity 
!= 
default  '
)' (
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Quantity' /
==0 2
request3 :
.: ;
Quantity; C
)C D
;D E
} 	
if   

(   
request   
.   
	DateOrder   
!=    
default  ! (
)  ( )
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
	Inventory$$. 7
>$$7 8
($$8 9
true$$9 =
)$$= >
;$$> ?
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
	DateOrder''' 0
==''1 3
request''4 ;
.''; <
	DateOrder''< E
)''E F
;''F G
}(( 	
if** 

(** 
!** 
string** 
.** 
IsNullOrWhiteSpace** &
(**& '
request**' .
.**. /
Order**/ 4
)**4 5
)**5 6
{++ 	
switch,, 
(,, 
request,, 
.,, 
Order,, !
),,! "
{-- 
case.. 
$str.. 
:.. 
ordeBy// 
=// 
x// 
=>// !
x//" #
.//# $
OrderBy//$ +
(//+ ,
n//, -
=>//. 0
n//1 2
.//2 3
Id//3 5
)//5 6
;//6 7
break00 
;00 
case22 
$str22 
:22  
ordeBy33 
=33 
x33 
=>33 !
x33" #
.33# $
OrderBy33$ +
(33+ ,
n33, -
=>33. 0
n331 2
.332 3
Quantity333 ;
)33; <
;33< =
break44 
;44 
case66 
$str66  
:66  !
ordeBy77 
=77 
x77 
=>77 !
x77" #
.77# $
OrderBy77$ +
(77+ ,
n77, -
=>77. 0
n771 2
.772 3
	DateOrder773 <
)77< =
;77= >
break88 
;88 
case:: 
$str::  
:::  !
ordeBy;; 
=;; 
x;; 
=>;; !
x;;" #
.;;# $
OrderBy;;$ +
(;;+ ,
n;;, -
=>;;. 0
n;;1 2
.;;2 3
	CreatedAt;;3 <
);;< =
;;;= >
break<< 
;<< 
case>> 
$str>>  
:>>  !
ordeBy?? 
=?? 
x?? 
=>?? !
x??" #
.??# $
OrderBy??$ +
(??+ ,
n??, -
=>??. 0
n??1 2
.??2 3
	UpdatedAt??3 <
)??< =
;??= >
break@@ 
;@@ 
caseBB 
$strBB  
:BB  !
ordeByCC 
=CC 
xCC 
=>CC !
xCC" #
.CC# $
OrderByCC$ +
(CC+ ,
nCC, -
=>CC. 0
nCC1 2
.CC2 3
	DeletedAtCC3 <
)CC< =
;CC= >
breakDD 
;DD 
defaultFF 
:FF 
ordeByGG 
=GG 
xGG 
=>GG !
xGG" #
.GG# $
OrderByGG$ +
(GG+ ,
nGG, -
=>GG. 0
nGG1 2
.GG2 3
IdGG3 5
)GG5 6
;GG6 7
breakHH 
;HH 
}II 
}JJ 	
ifLL 

(LL 
requestLL 
.LL 
	IdProductLL 
!=LL  
GuidLL! %
.LL% &
EmptyLL& +
)LL+ ,
{MM 	
ifNN 
(NN 
filterNN 
==NN 
nullNN 
)NN 
{OO 
filterPP 
=PP 
PredicateBuilderPP )
.PP) *
NewPP* -
<PP- .
	InventoryPP. 7
>PP7 8
(PP8 9
truePP9 =
)PP= >
;PP> ?
}QQ 
filterSS 
=SS 
filterSS 
.SS 
AndSS 
(SS  
xSS  !
=>SS" $
xSS% &
.SS& '
	IdProductSS' 0
==SS1 3
requestSS4 ;
.SS; <
	IdProductSS< E
)SSE F
;SSF G
}TT 	
ifVV 

(VV 
requestVV 
.VV 
IdVV 
!=VV 
GuidVV 
.VV 
EmptyVV $
)VV$ %
{WW 	
ifXX 
(XX 
filterXX 
==XX 
nullXX 
)XX 
{YY 
filterZZ 
=ZZ 
PredicateBuilderZZ )
.ZZ) *
NewZZ* -
<ZZ- .
	InventoryZZ. 7
>ZZ7 8
(ZZ8 9
trueZZ9 =
)ZZ= >
;ZZ> ?
}[[ 
filter]] 
=]] 
filter]] 
.]] 
And]] 
(]]  
x]]  !
=>]]" $
x]]% &
.]]& '
Id]]' )
==]]* ,
request]]- 4
.]]4 5
Id]]5 7
)]]7 8
;]]8 9
}^^ 	
if`` 

(`` 
request`` 
.`` 
	CreatedAt`` 
!=``  
default``! (
)``( )
{aa 	
ifbb 
(bb 
filterbb 
==bb 
nullbb 
)bb 
{cc 
filterdd 
=dd 
PredicateBuilderdd )
.dd) *
Newdd* -
<dd- .
	Inventorydd. 7
>dd7 8
(dd8 9
truedd9 =
)dd= >
;dd> ?
}ee 
filtergg 
=gg 
filtergg 
.gg 
Andgg 
(gg  
xgg  !
=>gg" $
xgg% &
.gg& '
	CreatedAtgg' 0
==gg1 3
requestgg4 ;
.gg; <
	CreatedAtgg< E
)ggE F
;ggF G
}hh 	
ifjj 

(jj 
requestjj 
.jj 
	UpdatedAtjj 
!=jj  
defaultjj! (
)jj( )
{kk 	
ifll 
(ll 
filterll 
==ll 
nullll 
)ll 
{mm 
filternn 
=nn 
PredicateBuildernn )
.nn) *
Newnn* -
<nn- .
	Inventorynn. 7
>nn7 8
(nn8 9
truenn9 =
)nn= >
;nn> ?
}oo 
filterqq 
=qq 
filterqq 
.qq 
Andqq 
(qq  
xqq  !
=>qq" $
xqq% &
.qq& '
	UpdatedAtqq' 0
==qq1 3
requestqq4 ;
.qq; <
	UpdatedAtqq< E
)qqE F
;qqF G
}rr 	
iftt 

(tt 
requesttt 
.tt 
	DeletedAttt 
.tt 
HasValuett &
||tt' )
requesttt* 1
.tt1 2
	DeletedAttt2 ;
!=tt< >
defaulttt? F
)ttF G
{uu 	
ifvv 
(vv 
filtervv 
==vv 
nullvv 
)vv 
{ww 
filterxx 
=xx 
PredicateBuilderxx )
.xx) *
Newxx* -
<xx- .
	Inventoryxx. 7
>xx7 8
(xx8 9
truexx9 =
)xx= >
;xx> ?
}yy 
filter{{ 
={{ 
filter{{ 
.{{ 
And{{ 
({{  
x{{  !
=>{{" $
x{{% &
.{{& '
	DeletedAt{{' 0
=={{1 3
request{{4 ;
.{{; <
	DeletedAt{{< E
){{E F
;{{F G
}|| 	
var~~ 
result~~ 
=~~ 
await~~  
_inventoryRepository~~ /
. 
Search 
( 
filter
ÄÄ 
,
ÄÄ 
ordeBy
ÅÅ 
,
ÅÅ 
request
ÇÇ 
.
ÇÇ 
PageSize
ÇÇ  
,
ÇÇ  !
request
ÉÉ 
.
ÉÉ 
	PageIndex
ÉÉ !
)
ÉÉ! "
;
ÉÉ" #
return
ÖÖ 
new
ÖÖ 

BaseResult
ÖÖ 
<
ÖÖ  
InventoryViewModel
ÖÖ 0
>
ÖÖ0 1
(
ÖÖ1 2
result
ÜÜ 
.
ÜÜ 
Data
ÜÜ 
.
ÜÜ 
Select
ÜÜ 
(
ÜÜ 
x
ÜÜ  
=>
ÜÜ! # 
InventoryViewModel
ÜÜ$ 6
.
ÜÜ6 7

FromEntity
ÜÜ7 A
(
ÜÜA B
x
ÜÜB C
)
ÜÜC D
)
ÜÜD E
.
ÜÜE F
ToList
ÜÜF L
(
ÜÜL M
)
ÜÜM N
,
ÜÜN O
result
ÜÜP V
.
ÜÜV W
PagedResult
ÜÜW b
)
ÜÜb c
;
ÜÜc d
}
áá 
}àà ˜
D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Queries\Handlers\GetByIdInventoryQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Inventories		$ /
.		/ 0
Queries		0 7
.		7 8
Handlers		8 @
;		@ A
public 
class (
GetByIdInventoryQueryHandler )
:* +
IRequestHandler, ;
<; <!
GetByIdInventoryQuery< Q
,Q R
InventoryViewModelS e
>e f
{ 
private 
readonly  
IInventoryRepository ) 
_inventoryRepository* >
;> ?
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
GetByIdInventoryQueryHandler '
(' ( 
IInventoryRepository 
inventoryRepository 0
,0 1
IMessageBusClient 

messageBus $
)$ %
{  
_inventoryRepository 
= 
inventoryRepository 2
;2 3
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
InventoryViewModel (
>( )
Handle* 0
(0 1!
GetByIdInventoryQuery 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await  
_inventoryRepository /
./ 0
GetById0 7
(7 8
request8 ?
.? @
Id@ B
)B C
;C D
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 I
,  I J
$str  K `
)  ` a
;  a b
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 3
)%%3 4
;%%4 5
}&& 	
return(( 
InventoryViewModel(( !
.((! "

FromEntity((" ,
(((, -
entity((- 3
)((3 4
;((4 5
})) 
}** –
oD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Queries\GetByIdInventoryQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Queries0 7
;7 8
public 
class !
GetByIdInventoryQuery "
:# $
IRequest% -
<- .
InventoryViewModel. @
>@ A
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 
!
GetByIdInventoryQuery

  
(

  !
Guid

! %
id

& (
)

( )
{ 
Id 

= 
id 
; 
} 
} ∆
qD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\UpdateInventoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Commands0 8
;8 9
public 
class "
UpdateInventoryCommand #
:$ %
IRequest& .
<. /
Guid/ 3
>3 4
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

int 
Quantity 
{ 
get 
; 
set "
;" #
}$ %
public		 

DateTime		 
	DateOrder		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public 

Guid 
	IdProduct 
{ 
get 
;  
set! $
;$ %
}& '
} 2
ÅD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\Handlers\UpdateInventoryCommandHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
Inventories		$ /
.		/ 0
Commands		0 8
.		8 9
Handlers		9 A
;		A B
public 
class )
UpdateInventoryCommandHandler *
:+ ,
IRequestHandler- <
<< ="
UpdateInventoryCommand= S
,S T
GuidU Y
>Y Z
{ 
private 
readonly  
IInventoryRepository ) 
_inventoryRepository* >
;> ?
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
)
UpdateInventoryCommandHandler (
(( ) 
IInventoryRepository 
inventoryRepository 0
,0 1
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{  
_inventoryRepository 
= 
inventoryRepository 2
;2 3
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #"
UpdateInventoryCommand 
request &
,& '
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await  
_inventoryRepository /
./ 0
GetById0 7
(7 8
request8 ?
.? @
Id@ B
)B C
;C D
if!! 

(!! 
entity!! 
==!! 
null!! 
)!! 
{"" 	
var## 
noticiation## 
=## 
new## !
NotificationError##" 3
(##3 4
$str##4 P
,##P Q
$str##R n
)##n o
;##o p
var$$ 

routingKey$$ 
=$$ 
noticiation$$ (
.$$( )
GetType$$) 0
($$0 1
)$$1 2
.$$2 3
Name$$3 7
.$$7 8

ToDashCase$$8 B
($$B C
)$$C D
;$$D E
_messageBus&& 
.&& 
Publish&& 
(&&  
noticiation&&  +
,&&+ ,

routingKey&&- 7
,&&7 8
$str&&9 N
)&&N O
;&&O P
throw(( 
new(( 
NotFoundException(( '
(((' (
$str((( 4
)((4 5
;((5 6
})) 	
entity++ 
.++ 
Update++ 
(++ 
request,, 
.,, 
Quantity,, 
,,, 
request-- 
.-- 
	DateOrder-- 
,-- 
request.. 
... 
	IdProduct.. 
).. 
;.. 
if00 

(00 
!00 
	Validator00 
.00 
Validate00 
(00  
new00  #
InventoryValidation00$ 7
(007 8
)008 9
,009 :
entity00; A
)00A B
)00B C
{11 	
var22 
noticiation22 
=22 
new22 !
NotificationError22" 3
(223 4
$str224 R
,22R S
$str22T r
)22r s
;22s t
var33 

routingKey33 
=33 
noticiation33 (
.33( )
GetType33) 0
(330 1
)331 2
.332 3
Name333 7
.337 8

ToDashCase338 B
(33B C
)33C D
;33D E
_messageBus55 
.55 
Publish55 
(55  
noticiation55  +
,55+ ,

routingKey55- 7
,557 8
$str559 N
)55N O
;55O P
throw77 
new77 
ValidationException77 )
(77) *
$str77* :
)77: ;
;77; <
}88 	
var:: 
product:: 
=:: 
await:: 
_productRepository:: .
.::. /
GetById::/ 6
(::6 7
request::7 >
.::> ?
	IdProduct::? H
)::H I
;::I J
if<< 

(<< 
product<< 
==<< 
null<< 
)<< 
{== 	
var>> 
noticiation>> 
=>> 
new>> !
NotificationError>>" 3
(>>3 4
$str>>4 G
,>>G H
$str>>I \
)>>\ ]
;>>] ^
var?? 

routingKey?? 
=?? 
noticiation?? (
.??( )
GetType??) 0
(??0 1
)??1 2
.??2 3
Name??3 7
.??7 8

ToDashCase??8 B
(??B C
)??C D
;??D E
_messageBusAA 
.AA 
PublishAA 
(AA  
noticiationAA  +
,AA+ ,

routingKeyAA- 7
,AA7 8
$strAA9 N
)AAN O
;AAO P
throwCC 
newCC 
NotFoundExceptionCC '
(CC' (
$strCC( ;
)CC; <
;CC< =
}DD 	
awaitFF  
_inventoryRepositoryFF "
.FF" #
UpdateFF# )
(FF) *
entityFF* 0
)FF0 1
;FF1 2
foreachHH 
(HH 
varHH 
@eventHH 
inHH 
entityHH %
.HH% &
EventsHH& ,
)HH, -
{II 	
varJJ 

routingKeyJJ 
=JJ 
@eventJJ #
.JJ# $
GetTypeJJ$ +
(JJ+ ,
)JJ, -
.JJ- .
NameJJ. 2
.JJ2 3

ToDashCaseJJ3 =
(JJ= >
)JJ> ?
;JJ? @
_messageBusLL 
.LL 
PublishLL 
(LL  
@eventLL  &
,LL& '

routingKeyLL( 2
,LL2 3
$strLL4 G
)LLG H
;LLH I
}MM 	
returnOO 
entityOO 
.OO 
IdOO 
;OO 
}PP 
}QQ ¿
zD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\Handlers\DeleteInventoryHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Commands0 8
.8 9
Handlers9 A
;A B
public

 
class

 "
DeleteInventoryHandler

 #
:

$ %
IRequestHandler

& 5
<

5 6"
DeleteInventoryCommand

6 L
,

L M
Unit

N R
>

R S
{ 
private 
readonly  
IInventoryRepository ) 
_inventoryRepository* >
;> ?
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
"
DeleteInventoryHandler !
(! " 
IInventoryRepository 
inventoryRepository 0
,0 1
IMessageBusClient 

messageBus $
)$ %
{  
_inventoryRepository 
= 
inventoryRepository 2
;2 3
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" #"
DeleteInventoryCommand 
request &
,& '
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await  
_inventoryRepository /
./ 0
GetById0 7
(7 8
request8 ?
.? @
Id@ B
)B C
;C D
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 P
,P Q
$strR n
)n o
;o p
var   

routingKey   
=   
noticiation   (
.  ( )
GetType  ) 0
(  0 1
)  1 2
.  2 3
Name  3 7
.  7 8

ToDashCase  8 B
(  B C
)  C D
;  D E
_messageBus"" 
."" 
Publish"" 
(""  
noticiation""  +
,""+ ,

routingKey""- 7
,""7 8
$str""9 N
)""N O
;""O P
throw$$ 
new$$ 
NotFoundException$$ '
($$' (
$str$$( 6
)$$6 7
;$$7 8
}%% 	
await''  
_inventoryRepository'' "
.''" #
Remove''# )
('') *
entity''* 0
.''0 1
Id''1 3
)''3 4
;''4 5
return)) 
Unit)) 
.)) 
Value)) 
;)) 
}** 
}++ ñ*
ÅD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\Handlers\CreateInventoryCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
Inventories

$ /
.

/ 0
Commands

0 8
.

8 9
Handlers

9 A
;

A B
public 
class )
CreateInventoryCommandHandler *
:+ ,
IRequestHandler- <
<< ="
CreateInventoryCommand= S
,S T
GuidU Y
>Y Z
{ 
private 
readonly  
IInventoryRepository ) 
_inventoryRepository* >
;> ?
private 
readonly 
IProductRepository '
_productRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
)
CreateInventoryCommandHandler (
(( ) 
IInventoryRepository 
inventoryRepository 0
,0 1
IProductRepository 
productRepository ,
,, -
IMessageBusClient 

messageBus $
) 	
{  
_inventoryRepository 
= 
inventoryRepository 2
;2 3
_productRepository 
= 
productRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #"
CreateInventoryCommand 
request &
,& '
CancellationToken 
cancellationToken +
)+ ,
{   
var!! 
entity!! 
=!! 
	Inventory!! 
.!! 
Create!! %
(!!% &
request!!& -
.!!- .
Quantity!!. 6
,!!6 7
request!!8 ?
.!!? @
	DateOrder!!@ I
,!!I J
request!!K R
.!!R S
	IdProduct!!S \
)!!\ ]
;!!] ^
if## 

(## 
!## 
	Validator## 
.## 
Validate## 
(##  
new##  #
InventoryValidation##$ 7
(##7 8
)##8 9
,##9 :
entity##; A
)##A B
)##B C
{$$ 	
var%% 
noticiation%% 
=%% 
new%% !
NotificationError%%" 3
(%%3 4
$str%%4 R
,%%R S
$str%%T r
)%%r s
;%%s t
var&& 

routingKey&& 
=&& 
noticiation&& (
.&&( )
GetType&&) 0
(&&0 1
)&&1 2
.&&2 3
Name&&3 7
.&&7 8

ToDashCase&&8 B
(&&B C
)&&C D
;&&D E
_messageBus(( 
.(( 
Publish(( 
(((  
noticiation((  +
,((+ ,

routingKey((- 7
,((7 8
$str((9 N
)((N O
;((O P
throw** 
new** 
ValidationException** )
(**) *
$str*** ;
)**; <
;**< =
}++ 	
var-- 
product-- 
=-- 
await-- 
_productRepository-- .
.--. /
GetById--/ 6
(--6 7
request--7 >
.--> ?
	IdProduct--? H
)--H I
;--I J
if// 

(// 
product// 
==// 
null// 
)// 
{00 	
var11 
noticiation11 
=11 
new11 !
NotificationError11" 3
(113 4
$str114 G
,11G H
$str11I \
)11\ ]
;11] ^
var22 

routingKey22 
=22 
noticiation22 (
.22( )
GetType22) 0
(220 1
)221 2
.222 3
Name223 7
.227 8

ToDashCase228 B
(22B C
)22C D
;22D E
_messageBus44 
.44 
Publish44 
(44  
noticiation44  +
,44+ ,

routingKey44- 7
,447 8
$str449 N
)44N O
;44O P
throw66 
new66 
NotFoundException66 '
(66' (
$str66( ;
)66; <
;66< =
}77 	
await99  
_inventoryRepository99 "
.99" #
Add99# &
(99& '
entity99' -
)99- .
;99. /
foreach;; 
(;; 
var;; 
@event;; 
in;; 
entity;; %
.;;% &
Events;;& ,
);;, -
{<< 	
var== 

routingKey== 
=== 
@event== #
.==# $
GetType==$ +
(==+ ,
)==, -
.==- .
Name==. 2
.==2 3

ToDashCase==3 =
(=== >
)==> ?
;==? @
_messageBus?? 
.?? 
Publish?? 
(??  
@event??  &
,??& '

routingKey??( 2
,??2 3
$str??4 G
)??G H
;??H I
}@@ 	
returnBB 
entityBB 
.BB 
IdBB 
;BB 
}CC 
}DD «
qD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\DeleteInventoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Commands0 8
;8 9
public 
class "
DeleteInventoryCommand #
:$ %
IRequest& .
<. /
Unit/ 3
>3 4
{ 
public 
"
DeleteInventoryCommand !
(! "
Guid" &
id' )
)) *
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} ≤
qD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Inventories\Commands\CreateInventoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Inventories$ /
./ 0
Commands0 8
;8 9
public 
class "
CreateInventoryCommand #
:$ %
IRequest& .
<. /
Guid/ 3
>3 4
{ 
public 

int 
Quantity 
{ 
get 
; 
set "
;" #
}$ %
public 

DateTime 
	DateOrder 
{ 
get  #
;# $
set% (
;( )
}* +
public

 

Guid

 
	IdProduct

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
} ‡
aD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Extensions\ExtensionsConfig.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Extensions$ .
;. /
public 
static 
class 
ExtensionsConfig $
{ 
public 

static 
string 

ToDashCase #
(# $
this$ (
string) /
text0 4
)4 5
{ 
if		 

(		 
text		 
==		 
null		 
)		 
{

 	
throw 
new !
ArgumentNullException +
(+ ,
nameof, 2
(2 3
text3 7
)7 8
)8 9
;9 :
} 	
if 

( 
text 
. 
Length 
< 
$num 
) 
{ 	
return 
text 
; 
} 	
var 
sb 
= 
new 
StringBuilder "
(" #
)# $
;$ %
sb 

.
 
Append 
( 
char 
. 
ToLowerInvariant '
(' (
text( ,
[, -
$num- .
]. /
)/ 0
)0 1
;1 2
for 
( 
int 
i 
= 
$num 
; 
i 
< 
text  
.  !
Length! '
;' (
++) +
i+ ,
), -
{ 	
char 
c 
= 
text 
[ 
i 
] 
; 
if 
( 
char 
. 
IsUpper 
( 
c 
) 
)  
{ 
sb 
. 
Append 
( 
$char 
) 
; 
sb 
. 
Append 
( 
char 
. 
ToLowerInvariant /
(/ 0
c0 1
)1 2
)2 3
;3 4
} 
else 
{ 
sb   
.   
Append   
(   
c   
)   
;   
}!! 
}"" 	
return$$ 
sb$$ 
.$$ 
ToString$$ 
($$ 
)$$ 
;$$ 
}%% 
}&& ó
cD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Dtos\ViewModels\BaseViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Dtos$ (
.( )

ViewModels) 3
;3 4
public 
abstract 
class 
BaseViewModel #
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

DateTime 
? 
	DeletedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
	protected

 
BaseViewModel

 
(

 
Guid

  
id

! #
,

# $
DateTime $
	createdAt% .
,. /
DateTime $
?$ %
	updatedAt& /
,/ 0
DateTime $
?$ %
	deletedAt& /
)/ 0
{ 
Id 

= 
id 
; 
	CreatedAt 
= 
	createdAt 
; 
	UpdatedAt 
= 
	updatedAt 
; 
	DeletedAt 
= 
	deletedAt 
; 
} 
} Ù'
fD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Dtos\ViewModels\AddressViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Dtos$ (
.( )

ViewModels) 3
;3 4
public 
class 
AddressViewModel 
: 
BaseViewModel  -
{ 
public 

string 
Street 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
Number 
{ 
get 
; 
set  #
;# $
}% &
public		 

string		 

Complement		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 

string

 
Neighborhood

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 

string 
District 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
City 
{ 
get 
; 
set !
;! "
}# $
public 

string 
County 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
ZipCode 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Latitude 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
	Longitude 
{ 
get !
;! "
set# &
;& '
}( )
public 

AddressViewModel 
( 
Guid 
id 
, 
string 
street 
, 
string 
number 
, 
string 

complement 
, 
string 
neighborhood 
, 
string 
district 
, 
string 
city 
, 
string 
county 
, 
string 
zipCode 
, 
string 
latitude 
, 
string 
	longitude 
, 
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime   
?   
	deletedAt   
)!! 
:!!	 

base!! 
(!! 
id!! 
,!! 
	createdAt!! 
,!! 
	updatedAt!! (
,!!( )
	deletedAt!!* 3
)!!3 4
{"" 
Street## 
=## 
street## 
;## 
Number$$ 
=$$ 
number$$ 
;$$ 

Complement%% 
=%% 

complement%% 
;%%  
Neighborhood&& 
=&& 
neighborhood&& #
;&&# $
District'' 
='' 
district'' 
;'' 
City(( 
=(( 
city(( 
;(( 
County)) 
=)) 
county)) 
;)) 
ZipCode** 
=** 
zipCode** 
;** 
Latitude++ 
=++ 
latitude++ 
;++ 
	Longitude,, 
=,, 
	longitude,, 
;,, 
}-- 
public// 

static// 
AddressViewModel// "

FromEntity//# -
(//- .
Address//. 5
entity//6 <
)//< =
{00 
return11 
new11 
AddressViewModel11 #
(11# $
entity22 
.22 
Id22 
,22 
entity33 
.33 
Street33 
,33 
entity44 
.44 
Number44 
,44 
entity55 
.55 

Complement55 
,55 
entity66 
.66 
Neighborhood66 
,66  
entity77 
.77 
District77 
,77 
entity88 
.88 
City88 
,88 
entity99 
.99 
County99 
,99 
entity:: 
.:: 
ZipCode:: 
,:: 
entity;; 
.;; 
Latitude;; 
,;; 
entity<< 
.<< 
	Longitude<< 
,<< 
entity== 
.== 
	CreatedAt== 
,== 
entity>> 
.>> 
	UpdatedAt>> 
,>> 
entity?? 
.?? 
	DeletedAt?? 
)?? 
;?? 
}@@ 
}AA ”
aD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Dtos\InputModels\BaseSearch.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Dtos$ (
.( )
InputModels) 4
;4 5
public 
abstract 
class 

BaseSearch  
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
	UpdatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	DeletedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 

string		 
?		 
Order		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
public 

int 
	PageIndex 
{ 
get 
; 
set  #
;# $
}% &
public 

int 
PageSize 
{ 
get 
; 
set "
;" #
}$ %
	protected 

BaseSearch 
( 
) 
{ 
	PageIndex 
= 
$num 
; 
PageSize 
= 
$num 
; 
} 
} ¶
hD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Dtos\InputModels\AddressInputModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Dtos$ (
.( )
InputModels) 4
;4 5
public 
class 
AddressInputModel 
{ 
public 

string 
Street 
{ 
get 
; 
private  '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
public 

string 
Number 
{ 
get 
; 
private  '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
public 

string 

Complement 
{ 
get "
;" #
private$ +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 

string 
Neighborhood 
{  
get! $
;$ %
private& -
set. 1
;1 2
}3 4
=5 6
string7 =
.= >
Empty> C
;C D
public		 

string		 
District		 
{		 
get		  
;		  !
private		" )
set		* -
;		- .
}		/ 0
=		1 2
string		3 9
.		9 :
Empty		: ?
;		? @
public

 

string

 
City

 
{

 
get

 
;

 
private

 %
set

& )
;

) *
}

+ ,
=

- .
string

/ 5
.

5 6
Empty

6 ;
;

; <
public 

string 
County 
{ 
get 
; 
private  '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
public 

string 
ZipCode 
{ 
get 
;  
private! (
set) ,
;, -
}. /
=0 1
string2 8
.8 9
Empty9 >
;> ?
public 

string 
Latitude 
{ 
get  
;  !
private" )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 

string 
	Longitude 
{ 
get !
;! "
private# *
set+ .
;. /
}0 1
=2 3
string4 :
.: ;
Empty; @
;@ A
}  
YD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\DependencyInjection.cs
	namespace 	
e_Estoque_API
 
. 
Application #
;# $
public		 
static		 
class		 
DependencyInjection		 '
{

 
public 

static 
IServiceCollection $"
AddApplicationServices% ;
(; <
this< @
IServiceCollectionA S
servicesT \
)\ ]
{ 
services 
. %
AddValidatorsFromAssembly *
(* +
typeof+ 1
(1 2
BaseViewModel2 ?
)? @
.@ A
AssemblyA I
)I J
;J K
services 
. 

AddMediatR 
( 
cfg 
=>  "
{ 	
cfg 
. (
RegisterServicesFromAssembly ,
(, -
typeof- 3
(3 4
BaseViewModel4 A
)A B
.B C
AssemblyC K
)K L
;L M
cfg 
. 
AddBehavior 
( 
typeof "
(" #
IPipelineBehavior# 4
<4 5
,5 6
>6 7
)7 8
,8 9
typeof: @
(@ A'
UnhandledExceptionBehaviourA \
<\ ]
,] ^
>^ _
)_ `
)` a
;a b
cfg 
. 
AddBehavior 
( 
typeof "
(" #
IPipelineBehavior# 4
<4 5
,5 6
>6 7
)7 8
,8 9
typeof: @
(@ A
ValidationBehaviourA T
<T U
,U V
>V W
)W X
)X Y
;Y Z
} 	
)	 

;
 
return 
services 
; 
} 
} â!
kD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\ViewModels\CompanyViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .

ViewModels. 8
;8 9
public 
class 
CustomerViewModel 
:  
BaseViewModel! .
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
DocId		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
public

 

string

 
Email

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 
IdCompanyAddress  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

AddressViewModel 
CompanyAddress *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 

CustomerViewModel 
( 
Guid 
id 
, 
string 
name 
, 
string 
docId 
, 
string 
email 
, 
string 
description 
, 
string 
phoneNumber 
, 
Guid 
idCompanyAddress 
, 
AddressViewModel 
companyAddress '
,' (
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime 
? 
	deletedAt 
) 	
:
 
base 
( 
id 
, 
	createdAt 
, 
	updatedAt  )
,) *
	deletedAt+ 4
)4 5
{ 
Name 
= 
name 
; 
DocId   
=   
docId   
;   
Email!! 
=!! 
email!! 
;!! 
Description"" 
="" 
description"" !
;""! "
PhoneNumber## 
=## 
phoneNumber## !
;##! "
IdCompanyAddress$$ 
=$$ 
idCompanyAddress$$ +
;$$+ ,
CompanyAddress%% 
=%% 
companyAddress%% '
;%%' (
}&& 
public(( 

static(( 
CustomerViewModel(( #

FromEntity(($ .
(((. /
Customer((/ 7
entity((8 >
)((> ?
{)) 
return** 
new** 
CustomerViewModel** $
(**$ %
entity++ 
.++ 
Id++ 
,++ 
entity,, 
.,, 
Name,, 
,,, 
entity-- 
.-- 
DocId-- 
,-- 
entity.. 
... 
Email.. 
,.. 
entity// 
.// 
Description// 
,// 
entity00 
.00 
PhoneNumber00 
,00 
entity11 
.11 
IdCustomerAddress11 $
,11$ %
AddressViewModel22 
.22 

FromEntity22 '
(22' (
entity22( .
.22. /
CustomerAddress22/ >
)22> ?
,22? @
entity33 
.33 
	CreatedAt33 
,33 
entity44 
.44 
	UpdatedAt44 
,44 
entity55 
.55 
	DeletedAt55 
)55 
;55 
}66 
}77 Ë
jD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Queries\SearchCompanyQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Queries. 5
;5 6
public 
class 
SearchCustomerQuery  
:! "

BaseSearch# -
,- .
IRequest/ 7
<7 8

BaseResult8 B
<B C
CustomerViewModelC T
>T U
>U V
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
string

' -
.

- .
Empty

. 3
;

3 4
public 

string 
DocId 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
} úp
zD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Queries\Handlers\SearchCompanyQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
	Customers		$ -
.		- .
Queries		. 5
.		5 6
Handlers		6 >
;		> ?
public 
class &
SearchCustomerQueryHandler '
:( )
IRequestHandler* 9
<9 :
SearchCustomerQuery: M
,M N

BaseResultO Y
<Y Z
CustomerViewModelZ k
>k l
>l m
{ 
private 
readonly 
ICustomerRepository (
_customerRepository) <
;< =
public 
&
SearchCustomerQueryHandler %
(% &
ICustomerRepository& 9
customerRepository: L
)L M
{ 
_customerRepository 
= 
customerRepository 0
;0 1
} 
public 

async 
Task 
< 

BaseResult  
<  !
CustomerViewModel! 2
>2 3
>3 4
Handle5 ;
(; <
SearchCustomerQuery 
request #
,# $
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
Customer  
,  !
bool" &
>& '
>' (
?( )
filter* 0
=1 2
null3 7
;7 8
Func 
< 

IQueryable 
< 
Customer  
>  !
,! "
IOrderedQueryable# 4
<4 5
Customer5 =
>= >
>> ?
?? @
ordeByA G
=H I
nullJ N
;N O
if 

( 
! 
string 
. 
IsNullOrWhiteSpace &
(& '
request' .
.. /
Name/ 3
)3 4
)4 5
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Name' +
==, .
request/ 6
.6 7
Name7 ;
); <
;< =
} 	
if   

(   
!   
string   
.   
IsNullOrWhiteSpace   &
(  & '
request  ' .
.  . /
Description  / :
)  : ;
)  ; <
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
Customer$$. 6
>$$6 7
($$7 8
true$$8 <
)$$< =
;$$= >
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
Description''' 2
==''3 5
request''6 =
.''= >
Description''> I
)''I J
;''J K
}(( 	
if** 

(** 
!** 
string** 
.** 
IsNullOrWhiteSpace** &
(**& '
request**' .
.**. /
DocId**/ 4
)**4 5
)**5 6
{++ 	
if,, 
(,, 
filter,, 
==,, 
null,, 
),, 
{-- 
filter.. 
=.. 
PredicateBuilder.. )
...) *
New..* -
<..- .
Customer... 6
>..6 7
(..7 8
true..8 <
)..< =
;..= >
}// 
filter11 
=11 
filter11 
.11 
And11 
(11  
x11  !
=>11" $
x11% &
.11& '
DocId11' ,
==11- /
request110 7
.117 8
DocId118 =
)11= >
;11> ?
}22 	
if44 

(44 
!44 
string44 
.44 
IsNullOrWhiteSpace44 &
(44& '
request44' .
.44. /
PhoneNumber44/ :
)44: ;
)44; <
{55 	
if66 
(66 
filter66 
==66 
null66 
)66 
{77 
filter88 
=88 
PredicateBuilder88 )
.88) *
New88* -
<88- .
Customer88. 6
>886 7
(887 8
true888 <
)88< =
;88= >
}99 
filter;; 
=;; 
filter;; 
.;; 
And;; 
(;;  
x;;  !
=>;;" $
x;;% &
.;;& '
PhoneNumber;;' 2
==;;3 5
request;;6 =
.;;= >
PhoneNumber;;> I
);;I J
;;;J K
}<< 	
if>> 

(>> 
!>> 
string>> 
.>> 
IsNullOrWhiteSpace>> &
(>>& '
request>>' .
.>>. /
Email>>/ 4
)>>4 5
)>>5 6
{?? 	
if@@ 
(@@ 
filter@@ 
==@@ 
null@@ 
)@@ 
{AA 
filterBB 
=BB 
PredicateBuilderBB )
.BB) *
NewBB* -
<BB- .
CustomerBB. 6
>BB6 7
(BB7 8
trueBB8 <
)BB< =
;BB= >
}CC 
filterEE 
=EE 
filterEE 
.EE 
AndEE 
(EE  
xEE  !
=>EE" $
xEE% &
.EE& '
EmailEE' ,
==EE- /
requestEE0 7
.EE7 8
EmailEE8 =
)EE= >
;EE> ?
}FF 	
ifHH 

(HH 
!HH 
stringHH 
.HH 
IsNullOrWhiteSpaceHH &
(HH& '
requestHH' .
.HH. /
OrderHH/ 4
)HH4 5
)HH5 6
{II 	
switchJJ 
(JJ 
requestJJ 
.JJ 
OrderJJ !
)JJ! "
{KK 
caseLL 
$strLL 
:LL 
ordeByMM 
=MM 
xMM 
=>MM !
xMM" #
.MM# $
OrderByMM$ +
(MM+ ,
nMM, -
=>MM. 0
nMM1 2
.MM2 3
IdMM3 5
)MM5 6
;MM6 7
breakNN 
;NN 
casePP 
$strPP 
:PP 
ordeByQQ 
=QQ 
xQQ 
=>QQ !
xQQ" #
.QQ# $
OrderByQQ$ +
(QQ+ ,
nQQ, -
=>QQ. 0
nQQ1 2
.QQ2 3
NameQQ3 7
)QQ7 8
;QQ8 9
breakRR 
;RR 
caseTT 
$strTT "
:TT" #
ordeByUU 
=UU 
xUU 
=>UU !
xUU" #
.UU# $
OrderByUU$ +
(UU+ ,
nUU, -
=>UU. 0
nUU1 2
.UU2 3
DescriptionUU3 >
)UU> ?
;UU? @
breakVV 
;VV 
caseXX 
$strXX 
:XX 
ordeByYY 
=YY 
xYY 
=>YY !
xYY" #
.YY# $
OrderByYY$ +
(YY+ ,
nYY, -
=>YY. 0
nYY1 2
.YY2 3
DocIdYY3 8
)YY8 9
;YY9 :
breakZZ 
;ZZ 
case\\ 
$str\\ 
:\\ 
ordeBy]] 
=]] 
x]] 
=>]] !
x]]" #
.]]# $
OrderBy]]$ +
(]]+ ,
n]], -
=>]]. 0
n]]1 2
.]]2 3
Email]]3 8
)]]8 9
;]]9 :
break^^ 
;^^ 
case`` 
$str`` "
:``" #
ordeByaa 
=aa 
xaa 
=>aa !
xaa" #
.aa# $
OrderByaa$ +
(aa+ ,
naa, -
=>aa. 0
naa1 2
.aa2 3
PhoneNumberaa3 >
)aa> ?
;aa? @
breakbb 
;bb 
casedd 
$strdd  
:dd  !
ordeByee 
=ee 
xee 
=>ee !
xee" #
.ee# $
OrderByee$ +
(ee+ ,
nee, -
=>ee. 0
nee1 2
.ee2 3
	CreatedAtee3 <
)ee< =
;ee= >
breakff 
;ff 
casehh 
$strhh  
:hh  !
ordeByii 
=ii 
xii 
=>ii !
xii" #
.ii# $
OrderByii$ +
(ii+ ,
nii, -
=>ii. 0
nii1 2
.ii2 3
	UpdatedAtii3 <
)ii< =
;ii= >
breakjj 
;jj 
casell 
$strll  
:ll  !
ordeBymm 
=mm 
xmm 
=>mm !
xmm" #
.mm# $
OrderBymm$ +
(mm+ ,
nmm, -
=>mm. 0
nmm1 2
.mm2 3
	DeletedAtmm3 <
)mm< =
;mm= >
breaknn 
;nn 
defaultpp 
:pp 
ordeByqq 
=qq 
xqq 
=>qq !
xqq" #
.qq# $
OrderByqq$ +
(qq+ ,
nqq, -
=>qq. 0
nqq1 2
.qq2 3
Idqq3 5
)qq5 6
;qq6 7
breakrr 
;rr 
}ss 
}tt 	
ifvv 

(vv 
requestvv 
.vv 
Idvv 
!=vv 
Guidvv 
.vv 
Emptyvv $
)vv$ %
{ww 	
ifxx 
(xx 
filterxx 
==xx 
nullxx 
)xx 
{yy 
filterzz 
=zz 
PredicateBuilderzz )
.zz) *
Newzz* -
<zz- .
Customerzz. 6
>zz6 7
(zz7 8
truezz8 <
)zz< =
;zz= >
}{{ 
filter}} 
=}} 
filter}} 
.}} 
And}} 
(}}  
x}}  !
=>}}" $
x}}% &
.}}& '
Id}}' )
==}}* ,
request}}- 4
.}}4 5
Id}}5 7
)}}7 8
;}}8 9
}~~ 	
if
ÄÄ 

(
ÄÄ 
request
ÄÄ 
.
ÄÄ 
	CreatedAt
ÄÄ 
!=
ÄÄ  
default
ÄÄ! (
)
ÄÄ( )
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 
filter
ÇÇ 
==
ÇÇ 
null
ÇÇ 
)
ÇÇ 
{
ÉÉ 
filter
ÑÑ 
=
ÑÑ 
PredicateBuilder
ÑÑ )
.
ÑÑ) *
New
ÑÑ* -
<
ÑÑ- .
Customer
ÑÑ. 6
>
ÑÑ6 7
(
ÑÑ7 8
true
ÑÑ8 <
)
ÑÑ< =
;
ÑÑ= >
}
ÖÖ 
filter
áá 
=
áá 
filter
áá 
.
áá 
And
áá 
(
áá  
x
áá  !
=>
áá" $
x
áá% &
.
áá& '
	CreatedAt
áá' 0
==
áá1 3
request
áá4 ;
.
áá; <
	CreatedAt
áá< E
)
ááE F
;
ááF G
}
àà 	
if
ää 

(
ää 
request
ää 
.
ää 
	UpdatedAt
ää 
!=
ää  
default
ää! (
)
ää( )
{
ãã 	
if
åå 
(
åå 
filter
åå 
==
åå 
null
åå 
)
åå 
{
çç 
filter
éé 
=
éé 
PredicateBuilder
éé )
.
éé) *
New
éé* -
<
éé- .
Customer
éé. 6
>
éé6 7
(
éé7 8
true
éé8 <
)
éé< =
;
éé= >
}
èè 
filter
ëë 
=
ëë 
filter
ëë 
.
ëë 
And
ëë 
(
ëë  
x
ëë  !
=>
ëë" $
x
ëë% &
.
ëë& '
	UpdatedAt
ëë' 0
==
ëë1 3
request
ëë4 ;
.
ëë; <
	UpdatedAt
ëë< E
)
ëëE F
;
ëëF G
}
íí 	
if
îî 

(
îî 
request
îî 
.
îî 
	DeletedAt
îî 
.
îî 
HasValue
îî &
||
îî' )
request
îî* 1
.
îî1 2
	DeletedAt
îî2 ;
!=
îî< >
default
îî? F
)
îîF G
{
ïï 	
if
ññ 
(
ññ 
filter
ññ 
==
ññ 
null
ññ 
)
ññ 
{
óó 
filter
òò 
=
òò 
PredicateBuilder
òò )
.
òò) *
New
òò* -
<
òò- .
Customer
òò. 6
>
òò6 7
(
òò7 8
true
òò8 <
)
òò< =
;
òò= >
}
ôô 
filter
õõ 
=
õõ 
filter
õõ 
.
õõ 
And
õõ 
(
õõ  
x
õõ  !
=>
õõ" $
x
õõ% &
.
õõ& '
	DeletedAt
õõ' 0
==
õõ1 3
request
õõ4 ;
.
õõ; <
	DeletedAt
õõ< E
)
õõE F
;
õõF G
}
úú 	
var
ûû 
result
ûû 
=
ûû 
await
ûû !
_customerRepository
ûû .
.
üü 
Search
üü 
(
üü 
filter
†† 
,
†† 
ordeBy
°° 
,
°° 
request
¢¢ 
.
¢¢ 
PageSize
¢¢  
,
¢¢  !
request
££ 
.
££ 
	PageIndex
££ !
)
££! "
;
££" #
return
•• 
new
•• 

BaseResult
•• 
<
•• 
CustomerViewModel
•• /
>
••/ 0
(
••0 1
result
¶¶ 
.
¶¶ 
Data
¶¶ 
.
¶¶ 
Select
¶¶ 
(
¶¶ 
x
¶¶  
=>
¶¶! #
CustomerViewModel
¶¶$ 5
.
¶¶5 6

FromEntity
¶¶6 @
(
¶¶@ A
x
¶¶A B
)
¶¶B C
)
¶¶C D
.
¶¶D E
ToList
¶¶E K
(
¶¶K L
)
¶¶L M
,
¶¶M N
result
¶¶O U
.
¶¶U V
PagedResult
¶¶V a
)
¶¶a b
;
¶¶b c
}
ßß 
}®® ·
{D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Queries\Handlers\GetByIdCompanyQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
	Customers		$ -
.		- .
Queries		. 5
.		5 6
Handlers		6 >
;		> ?
public 
class &
GetByICustomerQueryHandler '
:( )
IRequestHandler* 9
<9 : 
GetByIdCustomerQuery: N
,N O
CustomerViewModelP a
>a b
{ 
private 
readonly 
ICustomerRepository (
_customerRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
&
GetByICustomerQueryHandler %
(% &
ICustomerRepository 
customerRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_customerRepository 
= 
customerRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
CustomerViewModel '
>' (
Handle) /
(/ 0 
GetByIdCustomerQuery 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_customerRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 H
,  H I
$str  J ^
)  ^ _
;  _ `
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 3
)%%3 4
;%%4 5
}&& 	
return(( 
CustomerViewModel((  
.((  !

FromEntity((! +
(((+ ,
entity((, 2
)((2 3
;((3 4
})) 
}** «
kD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Queries\GetByIdCompanyQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Queries. 5
;5 6
public 
class  
GetByIdCustomerQuery !
:" #
IRequest$ ,
<, -
CustomerViewModel- >
>> ?
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 
 
GetByIdCustomerQuery

 
(

  
Guid

  $
id

% '
)

' (
{ 
Id 

= 
id 
; 
} 
} û
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\UpdateCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Commands. 6
;6 7
public 
class !
UpdateCustomerCommand "
:# $
IRequest% -
<- .
Guid. 2
>2 3
{ 
public 

Guid 
Id 
{ 
get 
; 
private !
set" %
;% &
}' (
public		 

string		 
Name		 
{		 
get		 
;		 
private		 %
set		& )
;		) *
}		+ ,
=		- .
string		/ 5
.		5 6
Empty		6 ;
;		; <
public

 

string

 
DocId

 
{

 
get

 
;

 
private

 &
set

' *
;

* +
}

, -
=

. /
string

0 6
.

6 7
Empty

7 <
;

< =
public 

string 
Email 
{ 
get 
; 
private &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 

string 
Description 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

string 
PhoneNumber 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

Guid 
IdCustomerAddress !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

AddressInputModel 
Address $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} Ñ;
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\Handlers\UpdateCompanyCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
	Customers

$ -
.

- .
Commands

. 6
.

6 7
Handlers

7 ?
;

? @
public 
class (
UpdateCustomerCommandHandler )
:* +
IRequestHandler, ;
<; <!
UpdateCustomerCommand< Q
,Q R
GuidS W
>W X
{ 
private 
readonly 
ICustomerRepository (
_customerRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
UpdateCustomerCommandHandler '
(' (
ICustomerRepository 
customerRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_customerRepository 
= 
customerRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #!
UpdateCustomerCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_customerRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{   	
var!! 
noticiation!! 
=!! 
new!! !
NotificationError!!" 3
(!!3 4
$str!!4 O
,!!O P
$str!!Q l
)!!l m
;!!m n
var"" 

routingKey"" 
="" 
noticiation"" (
.""( )
GetType"") 0
(""0 1
)""1 2
.""2 3
Name""3 7
.""7 8

ToDashCase""8 B
(""B C
)""C D
;""D E
_messageBus$$ 
.$$ 
Publish$$ 
($$  
noticiation$$  +
,$$+ ,

routingKey$$- 7
,$$7 8
$str$$9 N
)$$N O
;$$O P
throw&& 
new&& 
NotFoundException&& '
(&&' (
$str&&( 4
)&&4 5
;&&5 6
}'' 	
entity)) 
.** 
Update** 
(** 
request++ 
.++ 
Name++ 
,++ 
request,, 
.,, 
DocId,, 
,,, 
request-- 
.-- 
Email-- 
,-- 
request.. 
... 
Description.. #
,..# $
request// 
.// 
PhoneNumber// #
,//# $
request00 
.00 
IdCustomerAddress00 )
,00) *
new11 
CustomerAddress11 #
(11# $
request22 
.22 
Address22 #
.22# $
Street22$ *
,22* +
request33 
.33 
Address33 #
.33# $
Number33$ *
,33* +
request44 
.44 
Address44 #
.44# $

Complement44$ .
,44. /
request55 
.55 
Address55 #
.55# $
Neighborhood55$ 0
,550 1
request66 
.66 
Address66 #
.66# $
District66$ ,
,66, -
request77 
.77 
Address77 #
.77# $
City77$ (
,77( )
request88 
.88 
Address88 #
.88# $
County88$ *
,88* +
request99 
.99 
Address99 #
.99# $
ZipCode99$ +
,99+ ,
request:: 
.:: 
Address:: #
.::# $
Latitude::$ ,
,::, -
request;; 
.;; 
Address;; #
.;;# $
	Longitude;;$ -
);;- .
);;. /
;;;/ 0
if== 

(== 
!== 
	Validator== 
.== 
Validate== 
(==  
new==  #
CustomerValidation==$ 6
(==6 7
)==7 8
,==8 9
entity==: @
)==@ A
)==A B
{>> 	
var?? 
noticiation?? 
=?? 
new?? !
NotificationError??" 3
(??3 4
$str??4 Q
,??Q R
$str??S p
)??p q
;??q r
var@@ 

routingKey@@ 
=@@ 
noticiation@@ (
.@@( )
GetType@@) 0
(@@0 1
)@@1 2
.@@2 3
Name@@3 7
.@@7 8

ToDashCase@@8 B
(@@B C
)@@C D
;@@D E
_messageBusBB 
.BB 
PublishBB 
(BB  
noticiationBB  +
,BB+ ,

routingKeyBB- 7
,BB7 8
$strBB9 N
)BBN O
;BBO P
throwDD 
newDD 
ValidationExceptionDD )
(DD) *
$strDD* :
)DD: ;
;DD; <
}EE 	
ifGG 

(GG 
!GG 
	ValidatorGG 
.GG 
ValidateGG 
(GG  
newGG  #%
CustomerAddressValidationGG$ =
(GG= >
)GG> ?
,GG? @
entityGGA G
.GGG H
CustomerAddressGGH W
)GGW X
)GGX Y
{HH 	
varII 
noticiationII 
=II 
newII !
NotificationErrorII" 3
(II3 4
$strII4 P
,IIP Q
$strIIR n
)IIn o
;IIo p
varJJ 

routingKeyJJ 
=JJ 
noticiationJJ (
.JJ( )
GetTypeJJ) 0
(JJ0 1
)JJ1 2
.JJ2 3
NameJJ3 7
.JJ7 8

ToDashCaseJJ8 B
(JJB C
)JJC D
;JJD E
_messageBusLL 
.LL 
PublishLL 
(LL  
noticiationLL  +
,LL+ ,

routingKeyLL- 7
,LL7 8
$strLL9 N
)LLN O
;LLO P
throwNN 
newNN 
ValidationExceptionNN )
(NN) *
$strNN* :
)NN: ;
;NN; <
}OO 	
awaitQQ 
_customerRepositoryQQ !
.QQ! "
UpdateQQ" (
(QQ( )
entityQQ) /
)QQ/ 0
;QQ0 1
foreachSS 
(SS 
varSS 
@eventSS 
inSS 
entitySS %
.SS% &
EventsSS& ,
)SS, -
{TT 	
varUU 

routingKeyUU 
=UU 
@eventUU #
.UU# $
GetTypeUU$ +
(UU+ ,
)UU, -
.UU- .
NameUU. 2
.UU2 3

ToDashCaseUU3 =
(UU= >
)UU> ?
;UU? @
_messageBusWW 
.WW 
PublishWW 
(WW  
@eventWW  &
,WW& '

routingKeyWW( 2
,WW2 3
$strWW4 F
)WWF G
;WWG H
}XX 	
returnZZ 
entityZZ 
.ZZ 
IdZZ 
;ZZ 
}[[ 
}\\ √
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\Handlers\DeleteCompanyCommandHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Commands. 6
.6 7
Handlers7 ?
;? @
public

 
class

 (
DeleteCustomerCommandHandler

 )
:

* +
IRequestHandler

, ;
<

; <!
DeleteCustomerCommand

< Q
,

Q R
Unit

S W
>

W X
{ 
private 
readonly 
ICustomerRepository (
_customerRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
DeleteCustomerCommandHandler '
(' (
ICustomerRepository 
customerRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_customerRepository 
= 
customerRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" #!
DeleteCustomerCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_customerRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 O
,O P
$strQ l
)l m
;m n
var   

routingKey   
=   
noticiation   (
.  ( )
GetType  ) 0
(  0 1
)  1 2
.  2 3
Name  3 7
.  7 8

ToDashCase  8 B
(  B C
)  C D
;  D E
_messageBus"" 
."" 
Publish"" 
(""  
noticiation""  +
,""+ ,

routingKey""- 7
,""7 8
$str""9 N
)""N O
;""O P
throw$$ 
new$$ 
NotFoundException$$ '
($$' (
$str$$( 6
)$$6 7
;$$7 8
}%% 	
await'' 
_customerRepository'' !
.''! "
Remove''" (
(''( )
entity'') /
.''/ 0
Id''0 2
)''2 3
;''3 4
return)) 
Unit)) 
.)) 
Value)) 
;)) 
}** 
}++ ÿ1
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\Handlers\CreateCompanyCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
	Customers

$ -
.

- .
Commands

. 6
.

6 7
Handlers

7 ?
;

? @
public 
class (
CreateCustomerCommandHandler )
:* +
IRequestHandler, ;
<; <!
CreateCustomerCommand< Q
,Q R
GuidS W
>W X
{ 
private 
readonly 
ICustomerRepository (
_customerRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
CreateCustomerCommandHandler '
(' (
ICustomerRepository 
customerRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_customerRepository 
= 
customerRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #!
CreateCustomerCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
Customer 
. 
Create $
($ %
request 
. 
Name 
, 
request 
. 
DocId 
, 
request   
.   
Email   
,   
request!! 
.!! 
Description!! 
,!!  
request"" 
."" 
PhoneNumber"" 
,""  
new## 
CustomerAddress## 
(##  
request$$ 
.$$ 
Address$$ 
.$$  
Street$$  &
,$$& '
request%% 
.%% 
Address%% 
.%%  
Number%%  &
,%%& '
request&& 
.&& 
Address&& 
.&&  

Complement&&  *
,&&* +
request'' 
.'' 
Address'' 
.''  
Neighborhood''  ,
,'', -
request(( 
.(( 
Address(( 
.((  
District((  (
,((( )
request)) 
.)) 
Address)) 
.))  
City))  $
,))$ %
request** 
.** 
Address** 
.**  
County**  &
,**& '
request++ 
.++ 
Address++ 
.++  
ZipCode++  '
,++' (
request,, 
.,, 
Address,, 
.,,  
Latitude,,  (
,,,( )
request-- 
.-- 
Address-- 
.--  
	Longitude--  )
)--) *
)--* +
;--+ ,
if// 

(// 
!// 
	Validator// 
.// 
Validate// 
(//  
new//  #
CustomerValidation//$ 6
(//6 7
)//7 8
,//8 9
entity//: @
)//@ A
)//A B
{00 	
var11 
noticiation11 
=11 
new11 !
NotificationError11" 3
(113 4
$str114 Q
,11Q R
$str11S p
)11p q
;11q r
var22 

routingKey22 
=22 
noticiation22 (
.22( )
GetType22) 0
(220 1
)221 2
.222 3
Name223 7
.227 8

ToDashCase228 B
(22B C
)22C D
;22D E
_messageBus44 
.44 
Publish44 
(44  
noticiation44  +
,44+ ,

routingKey44- 7
,447 8
$str449 N
)44N O
;44O P
throw66 
new66 
ValidationException66 )
(66) *
$str66* :
)66: ;
;66; <
}77 	
if99 

(99 
!99 
	Validator99 
.99 
Validate99 
(99  
new99  #%
CustomerAddressValidation99$ =
(99= >
)99> ?
,99? @
entity99A G
.99G H
CustomerAddress99H W
)99W X
)99X Y
{:: 	
var;; 
noticiation;; 
=;; 
new;; !
NotificationError;;" 3
(;;3 4
$str;;4 Q
,;;Q R
$str;;S p
);;p q
;;;q r
var<< 

routingKey<< 
=<< 
noticiation<< (
.<<( )
GetType<<) 0
(<<0 1
)<<1 2
.<<2 3
Name<<3 7
.<<7 8

ToDashCase<<8 B
(<<B C
)<<C D
;<<D E
_messageBus>> 
.>> 
Publish>> 
(>>  
noticiation>>  +
,>>+ ,

routingKey>>- 7
,>>7 8
$str>>9 N
)>>N O
;>>O P
throw@@ 
new@@ 
ValidationException@@ )
(@@) *
$str@@* :
)@@: ;
;@@; <
}AA 	
awaitCC 
_customerRepositoryCC !
.CC! "
AddCC" %
(CC% &
entityCC& ,
)CC, -
;CC- .
foreachEE 
(EE 
varEE 
@eventEE 
inEE 
entityEE %
.EE% &
EventsEE& ,
)EE, -
{FF 	
varGG 

routingKeyGG 
=GG 
@eventGG #
.GG# $
GetTypeGG$ +
(GG+ ,
)GG, -
.GG- .
NameGG. 2
.GG2 3

ToDashCaseGG3 =
(GG= >
)GG> ?
;GG? @
_messageBusII 
.II 
PublishII 
(II  
@eventII  &
,II& '

routingKeyII( 2
,II2 3
$strII4 F
)IIF G
;IIG H
}JJ 	
returnLL 
entityLL 
.LL 
IdLL 
;LL 
}MM 
}NN ø
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\DeleteCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Commands. 6
;6 7
public 
class !
DeleteCustomerCommand "
:# $
IRequest% -
<- .
Unit. 2
>2 3
{ 
public 
!
DeleteCustomerCommand  
(  !
Guid! %
id& (
)( )
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} “
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Customers\Commands\CreateCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Customers$ -
.- .
Commands. 6
;6 7
public 
class !
CreateCustomerCommand "
:# $
IRequest% -
<- .
Guid. 2
>2 3
{ 
public 

string 
Name 
{ 
get 
; 
private %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public		 

string		 
DocId		 
{		 
get		 
;		 
private		 &
set		' *
;		* +
}		, -
=		. /
string		0 6
.		6 7
Empty		7 <
;		< =
public

 

string

 
Email

 
{

 
get

 
;

 
private

 &
set

' *
;

* +
}

, -
=

. /
string

0 6
.

6 7
Empty

7 <
;

< =
public 

string 
Description 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

string 
PhoneNumber 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

AddressInputModel 
Address $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} Ç!
kD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\ViewModels\CompanyViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .

ViewModels. 8
;8 9
public 
class 
CompanyViewModel 
: 
BaseViewModel  -
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
DocId		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
public

 

string

 
Email

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 
IdCompanyAddress  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

AddressViewModel 
CompanyAddress *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 

CompanyViewModel 
( 
Guid 
id 
, 
string 
name 
, 
string 
docId 
, 
string 
email 
, 
string 
description 
, 
string 
phoneNumber 
, 
Guid 
idCompanyAddress 
, 
AddressViewModel 
companyAddress '
,' (
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime 
? 
	deletedAt 
) 	
:
 
base 
( 
id 
, 
	createdAt 
, 
	updatedAt  )
,) *
	deletedAt+ 4
)4 5
{ 
Name 
= 
name 
; 
DocId   
=   
docId   
;   
Email!! 
=!! 
email!! 
;!! 
Description"" 
="" 
description"" !
;""! "
PhoneNumber## 
=## 
phoneNumber## !
;##! "
IdCompanyAddress$$ 
=$$ 
idCompanyAddress$$ +
;$$+ ,
CompanyAddress%% 
=%% 
companyAddress%% '
;%%' (
}&& 
public(( 

static(( 
CompanyViewModel(( "

FromEntity((# -
(((- .
Company((. 5
entity((6 <
)((< =
{)) 
return** 
new** 
CompanyViewModel** #
(**# $
entity++ 
.++ 
Id++ 
,++ 
entity,, 
.,, 
Name,, 
,,, 
entity-- 
.-- 
DocId-- 
,-- 
entity.. 
... 
Email.. 
,.. 
entity// 
.// 
Description// 
,// 
entity00 
.00 
PhoneNumber00 
,00 
entity11 
.11 
IdCompanyAddress11 #
,11# $
AddressViewModel22 
.22 

FromEntity22 '
(22' (
entity22( .
.22. /
CompanyAddress22/ =
)22= >
,22> ?
entity33 
.33 
	CreatedAt33 
,33 
entity44 
.44 
	UpdatedAt44 
,44 
entity55 
.55 
	DeletedAt55 
)55 
;55 
}66 
}77 Ê
jD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Queries\SearchCompanyQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Queries. 5
;5 6
public 
class 
SearchCompanyQuery 
:  !

BaseSearch" ,
,, -
IRequest. 6
<6 7

BaseResult7 A
<A B
CompanyViewModelB R
>R S
>S T
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
string

' -
.

- .
Empty

. 3
;

3 4
public 

string 
DocId 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
} Çp
zD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Queries\Handlers\SearchCompanyQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
	Companies		$ -
.		- .
Queries		. 5
.		5 6
Handlers		6 >
;		> ?
public 
class %
SearchCompanyQueryHandler &
:' (
IRequestHandler) 8
<8 9
SearchCompanyQuery9 K
,K L

BaseResultM W
<W X
CompanyViewModelX h
>h i
>i j
{ 
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
public 
%
SearchCompanyQueryHandler $
($ %
ICompanyRepository% 7
companyRepository8 I
)I J
{ 
_companyRepository 
= 
companyRepository .
;. /
} 
public 

async 
Task 
< 

BaseResult  
<  !
CompanyViewModel! 1
>1 2
>2 3
Handle4 :
(: ;
SearchCompanyQuery 
request "
," #
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
Company 
,  
bool! %
>% &
>& '
?' (
filter) /
=0 1
null2 6
;6 7
Func 
< 

IQueryable 
< 
Company 
>  
,  !
IOrderedQueryable" 3
<3 4
Company4 ;
>; <
>< =
?= >
ordeBy? E
=F G
nullH L
;L M
if 

( 
! 
string 
. 
IsNullOrWhiteSpace &
(& '
request' .
.. /
Name/ 3
)3 4
)4 5
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Name' +
==, .
request/ 6
.6 7
Name7 ;
); <
;< =
} 	
if   

(   
!   
string   
.   
IsNullOrWhiteSpace   &
(  & '
request  ' .
.  . /
Description  / :
)  : ;
)  ; <
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
Company$$. 5
>$$5 6
($$6 7
true$$7 ;
)$$; <
;$$< =
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
Description''' 2
==''3 5
request''6 =
.''= >
Description''> I
)''I J
;''J K
}(( 	
if** 

(** 
!** 
string** 
.** 
IsNullOrWhiteSpace** &
(**& '
request**' .
.**. /
DocId**/ 4
)**4 5
)**5 6
{++ 	
if,, 
(,, 
filter,, 
==,, 
null,, 
),, 
{-- 
filter.. 
=.. 
PredicateBuilder.. )
...) *
New..* -
<..- .
Company... 5
>..5 6
(..6 7
true..7 ;
)..; <
;..< =
}// 
filter11 
=11 
filter11 
.11 
And11 
(11  
x11  !
=>11" $
x11% &
.11& '
DocId11' ,
==11- /
request110 7
.117 8
DocId118 =
)11= >
;11> ?
}22 	
if44 

(44 
!44 
string44 
.44 
IsNullOrWhiteSpace44 &
(44& '
request44' .
.44. /
PhoneNumber44/ :
)44: ;
)44; <
{55 	
if66 
(66 
filter66 
==66 
null66 
)66 
{77 
filter88 
=88 
PredicateBuilder88 )
.88) *
New88* -
<88- .
Company88. 5
>885 6
(886 7
true887 ;
)88; <
;88< =
}99 
filter;; 
=;; 
filter;; 
.;; 
And;; 
(;;  
x;;  !
=>;;" $
x;;% &
.;;& '
PhoneNumber;;' 2
==;;3 5
request;;6 =
.;;= >
PhoneNumber;;> I
);;I J
;;;J K
}<< 	
if>> 

(>> 
!>> 
string>> 
.>> 
IsNullOrWhiteSpace>> &
(>>& '
request>>' .
.>>. /
Email>>/ 4
)>>4 5
)>>5 6
{?? 	
if@@ 
(@@ 
filter@@ 
==@@ 
null@@ 
)@@ 
{AA 
filterBB 
=BB 
PredicateBuilderBB )
.BB) *
NewBB* -
<BB- .
CompanyBB. 5
>BB5 6
(BB6 7
trueBB7 ;
)BB; <
;BB< =
}CC 
filterEE 
=EE 
filterEE 
.EE 
AndEE 
(EE  
xEE  !
=>EE" $
xEE% &
.EE& '
EmailEE' ,
==EE- /
requestEE0 7
.EE7 8
EmailEE8 =
)EE= >
;EE> ?
}FF 	
ifHH 

(HH 
!HH 
stringHH 
.HH 
IsNullOrWhiteSpaceHH &
(HH& '
requestHH' .
.HH. /
OrderHH/ 4
)HH4 5
)HH5 6
{II 	
switchJJ 
(JJ 
requestJJ 
.JJ 
OrderJJ !
)JJ! "
{KK 
caseLL 
$strLL 
:LL 
ordeByMM 
=MM 
xMM 
=>MM !
xMM" #
.MM# $
OrderByMM$ +
(MM+ ,
nMM, -
=>MM. 0
nMM1 2
.MM2 3
IdMM3 5
)MM5 6
;MM6 7
breakNN 
;NN 
casePP 
$strPP 
:PP 
ordeByQQ 
=QQ 
xQQ 
=>QQ !
xQQ" #
.QQ# $
OrderByQQ$ +
(QQ+ ,
nQQ, -
=>QQ. 0
nQQ1 2
.QQ2 3
NameQQ3 7
)QQ7 8
;QQ8 9
breakRR 
;RR 
caseTT 
$strTT "
:TT" #
ordeByUU 
=UU 
xUU 
=>UU !
xUU" #
.UU# $
OrderByUU$ +
(UU+ ,
nUU, -
=>UU. 0
nUU1 2
.UU2 3
DescriptionUU3 >
)UU> ?
;UU? @
breakVV 
;VV 
caseXX 
$strXX 
:XX 
ordeByYY 
=YY 
xYY 
=>YY !
xYY" #
.YY# $
OrderByYY$ +
(YY+ ,
nYY, -
=>YY. 0
nYY1 2
.YY2 3
DocIdYY3 8
)YY8 9
;YY9 :
breakZZ 
;ZZ 
case\\ 
$str\\ 
:\\ 
ordeBy]] 
=]] 
x]] 
=>]] !
x]]" #
.]]# $
OrderBy]]$ +
(]]+ ,
n]], -
=>]]. 0
n]]1 2
.]]2 3
Email]]3 8
)]]8 9
;]]9 :
break^^ 
;^^ 
case`` 
$str`` "
:``" #
ordeByaa 
=aa 
xaa 
=>aa !
xaa" #
.aa# $
OrderByaa$ +
(aa+ ,
naa, -
=>aa. 0
naa1 2
.aa2 3
PhoneNumberaa3 >
)aa> ?
;aa? @
breakbb 
;bb 
casedd 
$strdd  
:dd  !
ordeByee 
=ee 
xee 
=>ee !
xee" #
.ee# $
OrderByee$ +
(ee+ ,
nee, -
=>ee. 0
nee1 2
.ee2 3
	CreatedAtee3 <
)ee< =
;ee= >
breakff 
;ff 
casehh 
$strhh  
:hh  !
ordeByii 
=ii 
xii 
=>ii !
xii" #
.ii# $
OrderByii$ +
(ii+ ,
nii, -
=>ii. 0
nii1 2
.ii2 3
	UpdatedAtii3 <
)ii< =
;ii= >
breakjj 
;jj 
casell 
$strll  
:ll  !
ordeBymm 
=mm 
xmm 
=>mm !
xmm" #
.mm# $
OrderBymm$ +
(mm+ ,
nmm, -
=>mm. 0
nmm1 2
.mm2 3
	DeletedAtmm3 <
)mm< =
;mm= >
breaknn 
;nn 
defaultpp 
:pp 
ordeByqq 
=qq 
xqq 
=>qq !
xqq" #
.qq# $
OrderByqq$ +
(qq+ ,
nqq, -
=>qq. 0
nqq1 2
.qq2 3
Idqq3 5
)qq5 6
;qq6 7
breakrr 
;rr 
}ss 
}tt 	
ifvv 

(vv 
requestvv 
.vv 
Idvv 
!=vv 
Guidvv 
.vv 
Emptyvv $
)vv$ %
{ww 	
ifxx 
(xx 
filterxx 
==xx 
nullxx 
)xx 
{yy 
filterzz 
=zz 
PredicateBuilderzz )
.zz) *
Newzz* -
<zz- .
Companyzz. 5
>zz5 6
(zz6 7
truezz7 ;
)zz; <
;zz< =
}{{ 
filter}} 
=}} 
filter}} 
.}} 
And}} 
(}}  
x}}  !
=>}}" $
x}}% &
.}}& '
Id}}' )
==}}* ,
request}}- 4
.}}4 5
Id}}5 7
)}}7 8
;}}8 9
}~~ 	
if
ÄÄ 

(
ÄÄ 
request
ÄÄ 
.
ÄÄ 
	CreatedAt
ÄÄ 
!=
ÄÄ  
default
ÄÄ! (
)
ÄÄ( )
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 
filter
ÇÇ 
==
ÇÇ 
null
ÇÇ 
)
ÇÇ 
{
ÉÉ 
filter
ÑÑ 
=
ÑÑ 
PredicateBuilder
ÑÑ )
.
ÑÑ) *
New
ÑÑ* -
<
ÑÑ- .
Company
ÑÑ. 5
>
ÑÑ5 6
(
ÑÑ6 7
true
ÑÑ7 ;
)
ÑÑ; <
;
ÑÑ< =
}
ÖÖ 
filter
áá 
=
áá 
filter
áá 
.
áá 
And
áá 
(
áá  
x
áá  !
=>
áá" $
x
áá% &
.
áá& '
	CreatedAt
áá' 0
==
áá1 3
request
áá4 ;
.
áá; <
	CreatedAt
áá< E
)
ááE F
;
ááF G
}
àà 	
if
ää 

(
ää 
request
ää 
.
ää 
	UpdatedAt
ää 
!=
ää  
default
ää! (
)
ää( )
{
ãã 	
if
åå 
(
åå 
filter
åå 
==
åå 
null
åå 
)
åå 
{
çç 
filter
éé 
=
éé 
PredicateBuilder
éé )
.
éé) *
New
éé* -
<
éé- .
Company
éé. 5
>
éé5 6
(
éé6 7
true
éé7 ;
)
éé; <
;
éé< =
}
èè 
filter
ëë 
=
ëë 
filter
ëë 
.
ëë 
And
ëë 
(
ëë  
x
ëë  !
=>
ëë" $
x
ëë% &
.
ëë& '
	UpdatedAt
ëë' 0
==
ëë1 3
request
ëë4 ;
.
ëë; <
	UpdatedAt
ëë< E
)
ëëE F
;
ëëF G
}
íí 	
if
îî 

(
îî 
request
îî 
.
îî 
	DeletedAt
îî 
.
îî 
HasValue
îî &
||
îî' )
request
îî* 1
.
îî1 2
	DeletedAt
îî2 ;
!=
îî< >
default
îî? F
)
îîF G
{
ïï 	
if
ññ 
(
ññ 
filter
ññ 
==
ññ 
null
ññ 
)
ññ 
{
óó 
filter
òò 
=
òò 
PredicateBuilder
òò )
.
òò) *
New
òò* -
<
òò- .
Company
òò. 5
>
òò5 6
(
òò6 7
true
òò7 ;
)
òò; <
;
òò< =
}
ôô 
filter
õõ 
=
õõ 
filter
õõ 
.
õõ 
And
õõ 
(
õõ  
x
õõ  !
=>
õõ" $
x
õõ% &
.
õõ& '
	DeletedAt
õõ' 0
==
õõ1 3
request
õõ4 ;
.
õõ; <
	DeletedAt
õõ< E
)
õõE F
;
õõF G
}
úú 	
var
ûû 
result
ûû 
=
ûû 
await
ûû  
_companyRepository
ûû -
.
üü 
Search
üü 
(
üü 
filter
†† 
,
†† 
ordeBy
°° 
,
°° 
request
¢¢ 
.
¢¢ 
PageSize
¢¢  
,
¢¢  !
request
££ 
.
££ 
	PageIndex
££ !
)
££! "
;
££" #
return
•• 
new
•• 

BaseResult
•• 
<
•• 
CompanyViewModel
•• .
>
••. /
(
••/ 0
result
¶¶ 
.
¶¶ 
Data
¶¶ 
.
¶¶ 
Select
¶¶ 
(
¶¶ 
x
¶¶  
=>
¶¶! #
CompanyViewModel
¶¶$ 4
.
¶¶4 5

FromEntity
¶¶5 ?
(
¶¶? @
x
¶¶@ A
)
¶¶A B
)
¶¶B C
.
¶¶C D
ToList
¶¶D J
(
¶¶J K
)
¶¶K L
,
¶¶L M
result
¶¶N T
.
¶¶T U
PagedResult
¶¶U `
)
¶¶` a
;
¶¶a b
}
ßß 
}®® ’
{D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Queries\Handlers\GetByIdCompanyQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $
	Companies		$ -
.		- .
Queries		. 5
.		5 6
Handlers		6 >
;		> ?
public 
class &
GetByIdCompanyQueryHandler '
:( )
IRequestHandler* 9
<9 :
GetByIdCompanyQuery: M
,M N
CompanyViewModelO _
>_ `
{ 
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
&
GetByIdCompanyQueryHandler %
(% &
ICompanyRepository 
companyRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_companyRepository 
= 
companyRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
CompanyViewModel &
>& '
Handle( .
(. /
GetByIdCompanyQuery 
request #
,# $
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_companyRepository -
.- .
GetById. 5
(5 6
request6 =
.= >
Id> @
)@ A
;A B
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 G
,  G H
$str  I \
)  \ ]
;  ] ^
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 3
)%%3 4
;%%4 5
}&& 	
return(( 
CompanyViewModel(( 
.((  

FromEntity((  *
(((* +
entity((+ 1
)((1 2
;((2 3
})) 
}** ƒ
kD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Queries\GetByIdCompanyQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Queries. 5
;5 6
public 
class 
GetByIdCompanyQuery  
:! "
IRequest# +
<+ ,
CompanyViewModel, <
>< =
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 

GetByIdCompanyQuery

 
(

 
Guid

 #
id

$ &
)

& '
{ 
Id 

= 
id 
; 
} 
} ú
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\UpdateCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Commands. 6
;6 7
public 
class  
UpdateCompanyCommand !
:" #
IRequest$ ,
<, -
Guid- 1
>1 2
{ 
public 

Guid 
Id 
{ 
get 
; 
private !
set" %
;% &
}' (
public		 

string		 
Name		 
{		 
get		 
;		 
private		 %
set		& )
;		) *
}		+ ,
=		- .
string		/ 5
.		5 6
Empty		6 ;
;		; <
public

 

string

 
DocId

 
{

 
get

 
;

 
private

 &
set

' *
;

* +
}

, -
=

. /
string

0 6
.

6 7
Empty

7 <
;

< =
public 

string 
Email 
{ 
get 
; 
private &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 

string 
Description 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

string 
PhoneNumber 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

Guid 
IdCompanyAddress  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

AddressInputModel 
Address $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} Û:
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\Handlers\UpdateCompanyCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
	Companies

$ -
.

- .
Commands

. 6
.

6 7
Handlers

7 ?
;

? @
public 
class '
UpdateCompanyCommandHandler (
:) *
IRequestHandler+ :
<: ; 
UpdateCompanyCommand; O
,O P
GuidQ U
>U V
{ 
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
UpdateCompanyCommandHandler &
(& '
ICompanyRepository 
companyRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_companyRepository 
= 
companyRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" # 
UpdateCompanyCommand 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_companyRepository -
.- .
GetById. 5
(5 6
request6 =
.= >
Id> @
)@ A
;A B
if 

( 
entity 
== 
null 
) 
{   	
var!! 
noticiation!! 
=!! 
new!! !
NotificationError!!" 3
(!!3 4
$str!!4 N
,!!N O
$str!!P j
)!!j k
;!!k l
var"" 

routingKey"" 
="" 
noticiation"" (
.""( )
GetType"") 0
(""0 1
)""1 2
.""2 3
Name""3 7
.""7 8

ToDashCase""8 B
(""B C
)""C D
;""D E
_messageBus$$ 
.$$ 
Publish$$ 
($$  
noticiation$$  +
,$$+ ,

routingKey$$- 7
,$$7 8
$str$$9 N
)$$N O
;$$O P
throw&& 
new&& 
NotFoundException&& '
(&&' (
$str&&( 4
)&&4 5
;&&5 6
}'' 	
entity)) 
.** 
Update** 
(** 
request++ 
.++ 
Name++ 
,++ 
request,, 
.,, 
DocId,, 
,,, 
request-- 
.-- 
Email-- 
,-- 
request.. 
... 
Description.. #
,..# $
request// 
.// 
PhoneNumber// #
,//# $
request00 
.00 
IdCompanyAddress00 (
,00( )
new11 
CompanyAddress11 "
(11" #
request22 
.22 
Address22 #
.22# $
Street22$ *
,22* +
request33 
.33 
Address33 #
.33# $
Number33$ *
,33* +
request44 
.44 
Address44 #
.44# $

Complement44$ .
,44. /
request55 
.55 
Address55 #
.55# $
Neighborhood55$ 0
,550 1
request66 
.66 
Address66 #
.66# $
District66$ ,
,66, -
request77 
.77 
Address77 #
.77# $
City77$ (
,77( )
request88 
.88 
Address88 #
.88# $
County88$ *
,88* +
request99 
.99 
Address99 #
.99# $
ZipCode99$ +
,99+ ,
request:: 
.:: 
Address:: #
.::# $
Latitude::$ ,
,::, -
request;; 
.;; 
Address;; #
.;;# $
	Longitude;;$ -
);;- .
);;. /
;;;/ 0
if== 

(== 
!== 
	Validator== 
.== 
Validate== 
(==  
new==  #
CompanyValidation==$ 5
(==5 6
)==6 7
,==7 8
entity==9 ?
)==? @
)==@ A
{>> 	
var?? 
noticiation?? 
=?? 
new?? !
NotificationError??" 3
(??3 4
$str??4 P
,??P Q
$str??R n
)??n o
;??o p
var@@ 

routingKey@@ 
=@@ 
noticiation@@ (
.@@( )
GetType@@) 0
(@@0 1
)@@1 2
.@@2 3
Name@@3 7
.@@7 8

ToDashCase@@8 B
(@@B C
)@@C D
;@@D E
_messageBusBB 
.BB 
PublishBB 
(BB  
noticiationBB  +
,BB+ ,

routingKeyBB- 7
,BB7 8
$strBB9 N
)BBN O
;BBO P
throwDD 
newDD 
ValidationExceptionDD )
(DD) *
$strDD* :
)DD: ;
;DD; <
}EE 	
ifGG 

(GG 
!GG 
	ValidatorGG 
.GG 
ValidateGG 
(GG  
newGG  #$
CompanyAddressValidationGG$ <
(GG< =
)GG= >
,GG> ?
entityGG@ F
.GGF G
CompanyAddressGGG U
)GGU V
)GGV W
{HH 	
varII 
noticiationII 
=II 
newII !
NotificationErrorII" 3
(II3 4
$strII4 P
,IIP Q
$strIIR n
)IIn o
;IIo p
varJJ 

routingKeyJJ 
=JJ 
noticiationJJ (
.JJ( )
GetTypeJJ) 0
(JJ0 1
)JJ1 2
.JJ2 3
NameJJ3 7
.JJ7 8

ToDashCaseJJ8 B
(JJB C
)JJC D
;JJD E
_messageBusLL 
.LL 
PublishLL 
(LL  
noticiationLL  +
,LL+ ,

routingKeyLL- 7
,LL7 8
$strLL9 N
)LLN O
;LLO P
throwNN 
newNN 
ValidationExceptionNN )
(NN) *
$strNN* :
)NN: ;
;NN; <
}OO 	
awaitQQ 
_companyRepositoryQQ  
.QQ  !
UpdateQQ! '
(QQ' (
entityQQ( .
)QQ. /
;QQ/ 0
foreachSS 
(SS 
varSS 
@eventSS 
inSS 
entitySS %
.SS% &
EventsSS& ,
)SS, -
{TT 	
varUU 

routingKeyUU 
=UU 
@eventUU #
.UU# $
GetTypeUU$ +
(UU+ ,
)UU, -
.UU- .
NameUU. 2
.UU2 3

ToDashCaseUU3 =
(UU= >
)UU> ?
;UU? @
_messageBusWW 
.WW 
PublishWW 
(WW  
@eventWW  &
,WW& '

routingKeyWW( 2
,WW2 3
$strWW4 F
)WWF G
;WWG H
}XX 	
returnZZ 
entityZZ 
.ZZ 
IdZZ 
;ZZ 
}[[ 
}\\ ∑
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\Handlers\DeleteCompanyCommandHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Commands. 6
.6 7
Handlers7 ?
;? @
public

 
class

 '
DeleteCompanyCommandHandler

 (
:

) *
IRequestHandler

+ :
<

: ; 
DeleteCompanyCommand

; O
,

O P
Unit

Q U
>

U V
{ 
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
DeleteCompanyCommandHandler &
(& '
ICompanyRepository 
companyRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_companyRepository 
= 
companyRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" # 
DeleteCompanyCommand 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_companyRepository -
.- .
GetById. 5
(5 6
request6 =
.= >
Id> @
)@ A
;A B
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 N
,N O
$strP j
)j k
;k l
var   

routingKey   
=   
noticiation   (
.  ( )
GetType  ) 0
(  0 1
)  1 2
.  2 3
Name  3 7
.  7 8

ToDashCase  8 B
(  B C
)  C D
;  D E
_messageBus"" 
."" 
Publish"" 
(""  
noticiation""  +
,""+ ,

routingKey""- 7
,""7 8
$str""9 N
)""N O
;""O P
throw$$ 
new$$ 
NotFoundException$$ '
($$' (
$str$$( 6
)$$6 7
;$$7 8
}%% 	
await'' 
_companyRepository''  
.''  !
Remove''! '
(''' (
entity''( .
.''. /
Id''/ 1
)''1 2
;''2 3
return)) 
Unit)) 
.)) 
Value)) 
;)) 
}** 
}++ »1
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\Handlers\CreateCompanyCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $
	Companies

$ -
.

- .
Commands

. 6
.

6 7
Handlers

7 ?
;

? @
public 
class '
CreateCompanyCommandHandler (
:) *
IRequestHandler+ :
<: ; 
CreateCompanyCommand; O
,O P
GuidQ U
>U V
{ 
private 
readonly 
ICompanyRepository '
_companyRepository( :
;: ;
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
CreateCompanyCommandHandler &
(& '
ICompanyRepository 
companyRepository ,
,, -
IMessageBusClient 

messageBus $
)$ %
{ 
_companyRepository 
= 
companyRepository .
;. /
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" # 
CreateCompanyCommand 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
Company 
. 
Create #
(# $
request 
. 
Name 
, 
request 
. 
DocId 
, 
request   
.   
Email   
,   
request!! 
.!! 
Description!! 
,!!  
request"" 
."" 
PhoneNumber"" 
,""  
new## 
CompanyAddress## 
(## 
request$$ 
.$$ 
Address$$ 
.$$  
Street$$  &
,$$& '
request%% 
.%% 
Address%% 
.%%  
Number%%  &
,%%& '
request&& 
.&& 
Address&& 
.&&  

Complement&&  *
,&&* +
request'' 
.'' 
Address'' 
.''  
Neighborhood''  ,
,'', -
request(( 
.(( 
Address(( 
.((  
District((  (
,((( )
request)) 
.)) 
Address)) 
.))  
City))  $
,))$ %
request** 
.** 
Address** 
.**  
County**  &
,**& '
request++ 
.++ 
Address++ 
.++  
ZipCode++  '
,++' (
request,, 
.,, 
Address,, 
.,,  
Latitude,,  (
,,,( )
request-- 
.-- 
Address-- 
.--  
	Longitude--  )
)--) *
)--* +
;--+ ,
if// 

(// 
!// 
	Validator// 
.// 
Validate// 
(//  
new//  #
CompanyValidation//$ 5
(//5 6
)//6 7
,//7 8
entity//9 ?
)//? @
)//@ A
{00 	
var11 
noticiation11 
=11 
new11 !
NotificationError11" 3
(113 4
$str114 P
,11P Q
$str11R n
)11n o
;11o p
var22 

routingKey22 
=22 
noticiation22 (
.22( )
GetType22) 0
(220 1
)221 2
.222 3
Name223 7
.227 8

ToDashCase228 B
(22B C
)22C D
;22D E
_messageBus44 
.44 
Publish44 
(44  
noticiation44  +
,44+ ,

routingKey44- 7
,447 8
$str449 N
)44N O
;44O P
throw66 
new66 
ValidationException66 )
(66) *
$str66* :
)66: ;
;66; <
}77 	
if99 

(99 
!99 
	Validator99 
.99 
Validate99 
(99  
new99  #$
CompanyAddressValidation99$ <
(99< =
)99= >
,99> ?
entity99@ F
.99F G
CompanyAddress99G U
)99U V
)99V W
{:: 	
var;; 
noticiation;; 
=;; 
new;; !
NotificationError;;" 3
(;;3 4
$str;;4 P
,;;P Q
$str;;R n
);;n o
;;;o p
var<< 

routingKey<< 
=<< 
noticiation<< (
.<<( )
GetType<<) 0
(<<0 1
)<<1 2
.<<2 3
Name<<3 7
.<<7 8

ToDashCase<<8 B
(<<B C
)<<C D
;<<D E
_messageBus>> 
.>> 
Publish>> 
(>>  
noticiation>>  +
,>>+ ,

routingKey>>- 7
,>>7 8
$str>>9 N
)>>N O
;>>O P
throw@@ 
new@@ 
ValidationException@@ )
(@@) *
$str@@* :
)@@: ;
;@@; <
}AA 	
awaitCC 
_companyRepositoryCC  
.CC  !
AddCC! $
(CC$ %
entityCC% +
)CC+ ,
;CC, -
foreachEE 
(EE 
varEE 
@eventEE 
inEE 
entityEE %
.EE% &
EventsEE& ,
)EE, -
{FF 	
varGG 

routingKeyGG 
=GG 
@eventGG #
.GG# $
GetTypeGG$ +
(GG+ ,
)GG, -
.GG- .
NameGG. 2
.GG2 3

ToDashCaseGG3 =
(GG= >
)GG> ?
;GG? @
_messageBusII 
.II 
PublishII 
(II  
@eventII  &
,II& '

routingKeyII( 2
,II2 3
$strII4 E
)IIE F
;IIF G
}JJ 	
returnLL 
entityLL 
.LL 
IdLL 
;LL 
}MM 
}NN Ω
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\DeleteCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Commands. 6
;6 7
public 
class  
DeleteCompanyCommand !
:" #
IRequest$ ,
<, -
Unit- 1
>1 2
{ 
public 
 
DeleteCompanyCommand 
(  
Guid  $
id% '
)' (
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} —
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Companies\Commands\CreateCompanyCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
	Companies$ -
.- .
Commands. 6
;6 7
public 
class  
CreateCompanyCommand !
:" #
IRequest$ ,
<, -
Guid- 1
>1 2
{ 
public 

string 
Name 
{ 
get 
; 
private %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public		 

string		 
DocId		 
{		 
get		 
;		 
private		 &
set		' *
;		* +
}		, -
=		. /
string		0 6
.		6 7
Empty		7 <
;		< =
public

 

string

 
Email

 
{

 
get

 
;

 
private

 &
set

' *
;

* +
}

, -
=

. /
string

0 6
.

6 7
Empty

7 <
;

< =
public 

string 
Description 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

string 
PhoneNumber 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 

AddressInputModel 
Address $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
} —
kD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Common\Behaviours\ValidationBehaviour.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Common$ *
.* +

Behaviours+ 5
;5 6
public 
class 
ValidationBehaviour  
<  !
TRequest! )
,) *
	TResponse+ 4
>4 5
:6 7
IPipelineBehavior8 I
<I J
TRequestJ R
,R S
	TResponseT ]
>] ^
where 
TRequest 
: 
notnull 
{ 
private		 
readonly		 
IEnumerable		  
<		  !

IValidator		! +
<		+ ,
TRequest		, 4
>		4 5
>		5 6
_validators		7 B
;		B C
public 

ValidationBehaviour 
( 
IEnumerable *
<* +

IValidator+ 5
<5 6
TRequest6 >
>> ?
>? @

validatorsA K
)K L
{ 
_validators 
= 

validators  
;  !
} 
public 

async 
Task 
< 
	TResponse 
>  
Handle! '
(' (
TRequest( 0
request1 8
,8 9"
RequestHandlerDelegate: P
<P Q
	TResponseQ Z
>Z [
next\ `
,` a
CancellationTokenb s
cancellationToken	t Ö
)
Ö Ü
{ 
if 

( 
_validators 
. 
Any 
( 
) 
) 
{ 	
var 
context 
= 
new 
ValidationContext /
</ 0
TRequest0 8
>8 9
(9 :
request: A
)A B
;B C
var 
validationResults !
=" #
await$ )
Task* .
.. /
WhenAll/ 6
(6 7
_validators 
. 
Select "
(" #
v# $
=>% '
v 
. 
ValidateAsync #
(# $
context$ +
,+ ,
cancellationToken- >
)> ?
)? @
)@ A
;A B
var 
failures 
= 
validationResults ,
. 
Where 
( 
r 
=> 
r 
. 
Errors $
.$ %
Any% (
(( )
)) *
)* +
. 

SelectMany 
( 
r 
=>  
r! "
." #
Errors# )
)) *
. 
ToList 
( 
) 
; 
if 
( 
failures 
. 
Any 
( 
) 
) 
throw   
new   
ValidationException   -
(  - .
failures  . 6
)  6 7
;  7 8
}!! 	
return"" 
await"" 
next"" 
("" 
)"" 
;"" 
}## 
}$$ Ï
sD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Common\Behaviours\UnhandledExceptionBehaviour.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Common$ *
.* +

Behaviours+ 5
;5 6
public 
class '
UnhandledExceptionBehaviour (
<( )
TRequest) 1
,1 2
	TResponse3 <
>< =
:> ?
IPipelineBehavior@ Q
<Q R
TRequestR Z
,Z [
	TResponse\ e
>e f
whereg l
TRequestm u
:v w
notnullx 
{ 
private 
readonly 
ILogger 
< 
TRequest %
>% &
_logger' .
;. /
public

 
'
UnhandledExceptionBehaviour

 &
(

& '
ILogger

' .
<

. /
TRequest

/ 7
>

7 8
logger

9 ?
)

? @
{ 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
	TResponse 
>  
Handle! '
(' (
TRequest( 0
request1 8
,8 9"
RequestHandlerDelegate: P
<P Q
	TResponseQ Z
>Z [
next\ `
,` a
CancellationTokenb s
cancellationToken	t Ö
)
Ö Ü
{ 
try 
{ 	
return 
await 
next 
( 
) 
;  
} 	
catch 
( 
	Exception 
ex 
) 
{ 	
var 
requestName 
= 
typeof $
($ %
TRequest% -
)- .
.. /
Name/ 3
;3 4
_logger 
. 
LogError 
( 
ex 
,  
$str! o
,o p
requestNameq |
,| }
request	~ Ö
)
Ö Ü
;
Ü á
throw 
; 
} 	
} 
} ∞
pD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Common\Behaviours\ForbiddenAccessException.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Common$ *
.* +

Behaviours+ 5
;5 6
public 
class $
ForbiddenAccessException %
:& '
	Exception( 1
{ 
public 
$
ForbiddenAccessException #
(# $
string$ *
?* +
message, 3
)3 4
:5 6
base7 ;
(; <
message< C
)C D
{ 
} 
} Ï
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\ViewModels\CategoryViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /

ViewModels/ 9
;9 :
public 
class 
CategoryViewModel 
:  
BaseViewModel! .
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 

string

 
ShortDescription

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 

CategoryViewModel 
( 
Guid 
id 
, 
string 
name 
, 
string 
description 
, 
string 
shortDescription 
,  
DateTime 
	createdAt 
, 
DateTime 
? 
	updatedAt 
, 
DateTime 
? 
	deletedAt 
) 	
:
 
base 
( 
id 
, 
	createdAt 
, 
	updatedAt  )
,) *
	deletedAt+ 4
)4 5
{ 
Name 
= 
name 
; 
Description 
= 
description !
;! "
ShortDescription 
= 
shortDescription +
;+ ,
} 
public 

static 
CategoryViewModel #

FromEntity$ .
(. /
Category/ 7
entity8 >
)> ?
{ 
return 
new 
CategoryViewModel $
($ %
entity 
. 
Id 
, 
entity 
. 
Name 
, 
entity   
.   
Description   
,   
entity!! 
.!! 
ShortDescription!! #
,!!# $
entity"" 
."" 
	CreatedAt"" 
,"" 
entity## 
.## 
	UpdatedAt## 
,## 
entity$$ 
.$$ 
	DeletedAt$$ 
)$$ 
;$$ 
}%% 
}&& ñ

lD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Queries\SearchCategoryQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Queries/ 6
;6 7
public 
class 
SearchCategoryQuery  
:! "

BaseSearch# -
,- .
IRequest/ 7
<7 8

BaseResult8 B
<B C
CategoryViewModelC T
>T U
>U V
{		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
string

' -
.

- .
Empty

. 3
;

3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
ShortDescription "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
} ¥[
|D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Queries\Handlers\SearchCategoryQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $

Categories		$ .
.		. /
Queries		/ 6
.		6 7
Handlers		7 ?
;		? @
public 
class &
SearchCategoryQueryHandler '
:( )
IRequestHandler* 9
<9 :
SearchCategoryQuery: M
,M N

BaseResultO Y
<Y Z
CategoryViewModelZ k
>k l
>l m
{ 
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
public 
&
SearchCategoryQueryHandler %
(% &
ICategoryRepository& 9
categoryRepository: L
)L M
{ 
_categoryRepository 
= 
categoryRepository 0
;0 1
} 
public 

async 
Task 
< 

BaseResult  
<  !
CategoryViewModel! 2
>2 3
>3 4
Handle5 ;
(; <
SearchCategoryQuery 
request #
,# $
CancellationToken 
cancellationToken +
)+ ,
{ 

Expression 
< 
Func 
< 
Category  
,  !
bool" &
>& '
>' (
?( )
filter* 0
=1 2
null3 7
;7 8
Func 
< 

IQueryable 
< 
Category  
>  !
,! "
IOrderedQueryable# 4
<4 5
Category5 =
>= >
>> ?
?? @
ordeByA G
=H I
nullJ N
;N O
if 

( 
! 
string 
. 
IsNullOrWhiteSpace &
(& '
request' .
.. /
Name/ 3
)3 4
)4 5
{ 	
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
Name' +
==, .
request/ 6
.6 7
Name7 ;
); <
;< =
} 	
if   

(   
!   
string   
.   
IsNullOrWhiteSpace   &
(  & '
request  ' .
.  . /
Description  / :
)  : ;
)  ; <
{!! 	
if"" 
("" 
filter"" 
=="" 
null"" 
)"" 
{## 
filter$$ 
=$$ 
PredicateBuilder$$ )
.$$) *
New$$* -
<$$- .
Category$$. 6
>$$6 7
($$7 8
true$$8 <
)$$< =
;$$= >
}%% 
filter'' 
='' 
filter'' 
.'' 
And'' 
(''  
x''  !
=>''" $
x''% &
.''& '
Description''' 2
==''3 5
request''6 =
.''= >
Description''> I
)''I J
;''J K
}(( 	
if** 

(** 
!** 
string** 
.** 
IsNullOrWhiteSpace** &
(**& '
request**' .
.**. /
ShortDescription**/ ?
)**? @
)**@ A
{++ 	
if,, 
(,, 
filter,, 
==,, 
null,, 
),, 
{-- 
filter.. 
=.. 
PredicateBuilder.. )
...) *
New..* -
<..- .
Category... 6
>..6 7
(..7 8
true..8 <
)..< =
;..= >
}// 
filter11 
=11 
filter11 
.11 
And11 
(11  
x11  !
=>11" $
x11% &
.11& '
Description11' 2
==113 5
request116 =
.11= >
ShortDescription11> N
)11N O
;11O P
}22 	
if44 

(44 
!44 
string44 
.44 
IsNullOrWhiteSpace44 &
(44& '
request44' .
.44. /
Order44/ 4
)444 5
)445 6
{55 	
switch66 
(66 
request66 
.66 
Order66 !
)66! "
{77 
case88 
$str88 
:88 
ordeBy99 
=99 
x99 
=>99 !
x99" #
.99# $
OrderBy99$ +
(99+ ,
n99, -
=>99. 0
n991 2
.992 3
Id993 5
)995 6
;996 7
break:: 
;:: 
case<< 
$str<< 
:<< 
ordeBy== 
=== 
x== 
=>== !
x==" #
.==# $
OrderBy==$ +
(==+ ,
n==, -
=>==. 0
n==1 2
.==2 3
Name==3 7
)==7 8
;==8 9
break>> 
;>> 
case@@ 
$str@@ "
:@@" #
ordeByAA 
=AA 
xAA 
=>AA !
xAA" #
.AA# $
OrderByAA$ +
(AA+ ,
nAA, -
=>AA. 0
nAA1 2
.AA2 3
DescriptionAA3 >
)AA> ?
;AA? @
breakBB 
;BB 
caseDD 
$strDD '
:DD' (
ordeByEE 
=EE 
xEE 
=>EE !
xEE" #
.EE# $
OrderByEE$ +
(EE+ ,
nEE, -
=>EE. 0
nEE1 2
.EE2 3
ShortDescriptionEE3 C
)EEC D
;EED E
breakFF 
;FF 
caseHH 
$strHH  
:HH  !
ordeByII 
=II 
xII 
=>II !
xII" #
.II# $
OrderByII$ +
(II+ ,
nII, -
=>II. 0
nII1 2
.II2 3
	CreatedAtII3 <
)II< =
;II= >
breakJJ 
;JJ 
caseLL 
$strLL  
:LL  !
ordeByMM 
=MM 
xMM 
=>MM !
xMM" #
.MM# $
OrderByMM$ +
(MM+ ,
nMM, -
=>MM. 0
nMM1 2
.MM2 3
	UpdatedAtMM3 <
)MM< =
;MM= >
breakNN 
;NN 
casePP 
$strPP  
:PP  !
ordeByQQ 
=QQ 
xQQ 
=>QQ !
xQQ" #
.QQ# $
OrderByQQ$ +
(QQ+ ,
nQQ, -
=>QQ. 0
nQQ1 2
.QQ2 3
	DeletedAtQQ3 <
)QQ< =
;QQ= >
breakRR 
;RR 
defaultTT 
:TT 
ordeByUU 
=UU 
xUU 
=>UU !
xUU" #
.UU# $
OrderByUU$ +
(UU+ ,
nUU, -
=>UU. 0
nUU1 2
.UU2 3
IdUU3 5
)UU5 6
;UU6 7
breakVV 
;VV 
}WW 
}XX 	
ifZZ 

(ZZ 
requestZZ 
.ZZ 
IdZZ 
!=ZZ 
GuidZZ 
.ZZ 
EmptyZZ $
)ZZ$ %
{[[ 	
if\\ 
(\\ 
filter\\ 
==\\ 
null\\ 
)\\ 
{]] 
filter^^ 
=^^ 
PredicateBuilder^^ )
.^^) *
New^^* -
<^^- .
Category^^. 6
>^^6 7
(^^7 8
true^^8 <
)^^< =
;^^= >
}__ 
filteraa 
=aa 
filteraa 
.aa 
Andaa 
(aa  
xaa  !
=>aa" $
xaa% &
.aa& '
Idaa' )
==aa* ,
requestaa- 4
.aa4 5
Idaa5 7
)aa7 8
;aa8 9
}bb 	
ifdd 

(dd 
requestdd 
.dd 
	CreatedAtdd 
!=dd  
defaultdd! (
)dd( )
{ee 	
ifff 
(ff 
filterff 
==ff 
nullff 
)ff 
{gg 
filterhh 
=hh 
PredicateBuilderhh )
.hh) *
Newhh* -
<hh- .
Categoryhh. 6
>hh6 7
(hh7 8
truehh8 <
)hh< =
;hh= >
}ii 
filterkk 
=kk 
filterkk 
.kk 
Andkk 
(kk  
xkk  !
=>kk" $
xkk% &
.kk& '
	CreatedAtkk' 0
==kk1 3
requestkk4 ;
.kk; <
	CreatedAtkk< E
)kkE F
;kkF G
}ll 	
ifnn 

(nn 
requestnn 
.nn 
	UpdatedAtnn 
!=nn  
defaultnn! (
)nn( )
{oo 	
ifpp 
(pp 
filterpp 
==pp 
nullpp 
)pp 
{qq 
filterrr 
=rr 
PredicateBuilderrr )
.rr) *
Newrr* -
<rr- .
Categoryrr. 6
>rr6 7
(rr7 8
truerr8 <
)rr< =
;rr= >
}ss 
filteruu 
=uu 
filteruu 
.uu 
Anduu 
(uu  
xuu  !
=>uu" $
xuu% &
.uu& '
	UpdatedAtuu' 0
==uu1 3
requestuu4 ;
.uu; <
	UpdatedAtuu< E
)uuE F
;uuF G
}vv 	
ifxx 

(xx 
requestxx 
.xx 
	DeletedAtxx 
.xx 
HasValuexx &
||xx' )
requestxx* 1
.xx1 2
	DeletedAtxx2 ;
!=xx< >
defaultxx? F
)xxF G
{yy 	
ifzz 
(zz 
filterzz 
==zz 
nullzz 
)zz 
{{{ 
filter|| 
=|| 
PredicateBuilder|| )
.||) *
New||* -
<||- .
Category||. 6
>||6 7
(||7 8
true||8 <
)||< =
;||= >
}}} 
filter 
= 
filter 
. 
And 
(  
x  !
=>" $
x% &
.& '
	DeletedAt' 0
==1 3
request4 ;
.; <
	DeletedAt< E
)E F
;F G
}
ÄÄ 	
var
ÇÇ 
result
ÇÇ 
=
ÇÇ 
await
ÇÇ !
_categoryRepository
ÇÇ .
.
ÉÉ 
Search
ÉÉ 
(
ÉÉ 
filter
ÑÑ 
,
ÑÑ 
ordeBy
ÖÖ 
,
ÖÖ 
request
ÜÜ 
.
ÜÜ 
PageSize
ÜÜ  
,
ÜÜ  !
request
áá 
.
áá 
	PageIndex
áá !
)
áá! "
;
áá" #
return
ââ 
new
ââ 

BaseResult
ââ 
<
ââ 
CategoryViewModel
ââ /
>
ââ/ 0
(
ââ0 1
result
ää 
.
ää 
Data
ää 
.
ää 
Select
ää 
(
ää 
x
ää  
=>
ää! #
CategoryViewModel
ää$ 5
.
ää5 6

FromEntity
ää6 @
(
ää@ A
x
ääA B
)
ääB C
)
ääC D
.
ääD E
ToList
ääE K
(
ääK L
)
ääL M
,
ääM N
result
ääO U
.
ääU V
PagedResult
ääV a
)
ääa b
;
ääb c
}
ãã 
}åå Ê
}D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Queries\Handlers\GetByIdCategoryQueryHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $

Categories		$ .
.		. /
Queries		/ 6
.		6 7
Handlers		7 ?
;		? @
public 
class '
GetByIdCategoryQueryHandler (
:) *
IRequestHandler+ :
<: ; 
GetByIdCategoryQuery; O
,O P
CategoryViewModelQ b
>b c
{ 
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
'
GetByIdCategoryQueryHandler &
(& '
ICategoryRepository' :
categoryRepository; M
,M N
IMessageBusClientO `

messageBusa k
)k l
{ 
_categoryRepository 
= 
categoryRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
CategoryViewModel '
>' (
Handle) /
(/ 0 
GetByIdCategoryQuery 
request $
,$ %
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_categoryRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{ 	
var 
noticiation 
= 
new !
NotificationError" 3
(3 4
$str4 H
,H I
$strJ ^
)^ _
;_ `
var 

routingKey 
= 
noticiation (
.( )
GetType) 0
(0 1
)1 2
.2 3
Name3 7
.7 8

ToDashCase8 B
(B C
)C D
;D E
_messageBus!! 
.!! 
Publish!! 
(!!  
noticiation!!  +
,!!+ ,

routingKey!!- 7
,!!7 8
$str!!9 N
)!!N O
;!!O P
throw## 
new## 
NotFoundException## '
(##' (
$str##( 3
)##3 4
;##4 5
}$$ 	
return&& 
CategoryViewModel&&  
.&&  !

FromEntity&&! +
(&&+ ,
entity&&, 2
)&&2 3
;&&3 4
}'' 
}((  
mD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Queries\GetByIdCategoryQuery.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Queries/ 6
;6 7
public 
class  
GetByIdCategoryQuery !
:" #
IRequest$ ,
<, -
CategoryViewModel- >
>> ?
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public

 
 
GetByIdCategoryQuery

 
(

  
Guid

  $
id

% '
)

' (
{ 
Id 

= 
id 
; 
} 
} ª
oD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\UpdateCategoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Commands/ 7
;7 8
public 
class !
UpdateCategoryCommand "
:# $
IRequest% -
<- .
Guid. 2
>2 3
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
ShortDescription		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 

string

 
Description

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
!
UpdateCategoryCommand  
(  !
Guid! %
id& (
,( )
string* 0
name1 5
,5 6
string7 =
shortDescription> N
,N O
stringP V
descriptionW b
)b c
{ 
Id 

= 
id 
; 
Name 
= 
name 
; 
ShortDescription 
= 
shortDescription +
;+ ,
Description 
= 
description !
;! "
} 
} ™'
D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\Handlers\UpdateCategoryCommandHandler.cs
	namespace		 	
e_Estoque_API		
 
.		 
Application		 #
.		# $

Categories		$ .
.		. /
Commands		/ 7
.		7 8
Handlers		8 @
;		@ A
public 
class (
UpdateCategoryCommandHandler )
:* +
IRequestHandler, ;
<; <!
UpdateCategoryCommand< Q
,Q R
GuidS W
>W X
{ 
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
UpdateCategoryCommandHandler '
(' (
ICategoryRepository 
categoryRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_categoryRepository 
= 
categoryRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #!
UpdateCategoryCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_categoryRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 O
,  O P
$str  Q l
)  l m
;  m n
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 4
)%%4 5
;%%5 6
}&& 	
entity(( 
.)) 
Update)) 
()) 
request** 
.** 
Name** 
,** 
request++ 
.++ 
ShortDescription++ $
,++$ %
request,, 
.,, 
Description,, 
),,  
;,,  !
if.. 

(.. 
!.. 
	Validator.. 
... 
Validate.. 
(..  
new..  #
CategoryValidation..$ 6
(..6 7
)..7 8
,..8 9
entity..: @
)..@ A
)..A B
{// 	
var00 
noticiation00 
=00 
new00 !
NotificationError00" 3
(003 4
$str004 Q
,00Q R
$str00S p
)00p q
;00q r
var11 

routingKey11 
=11 
noticiation11 (
.11( )
GetType11) 0
(110 1
)111 2
.112 3
Name113 7
.117 8

ToDashCase118 B
(11B C
)11C D
;11D E
_messageBus33 
.33 
Publish33 
(33  
noticiation33  +
,33+ ,

routingKey33- 7
,337 8
$str339 N
)33N O
;33O P
throw55 
new55 
ValidationException55 )
(55) *
$str55* :
)55: ;
;55; <
}66 	
await88 
_categoryRepository88 !
.88! "
Update88" (
(88( )
entity88) /
)88/ 0
;880 1
foreach:: 
(:: 
var:: 
@event:: 
in:: 
entity:: %
.::% &
Events::& ,
)::, -
{;; 	
var<< 

routingKey<< 
=<< 
@event<< #
.<<# $
GetType<<$ +
(<<+ ,
)<<, -
.<<- .
Name<<. 2
.<<2 3

ToDashCase<<3 =
(<<= >
)<<> ?
;<<? @
_messageBus>> 
.>> 
Publish>> 
(>>  
@event>>  &
,>>& '

routingKey>>( 2
,>>2 3
$str>>4 F
)>>F G
;>>G H
}?? 	
returnAA 
entityAA 
.AA 
IdAA 
;AA 
}BB 
}CC ±
xD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\Handlers\DeleteCategoryHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Commands/ 7
.7 8
Handlers8 @
;@ A
public

 
class

 !
DeleteCategoryHandler

 "
:

# $
IRequestHandler

% 4
<

4 5!
DeleteCategoryCommand

5 J
,

J K
Unit

L P
>

P Q
{ 
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
!
DeleteCategoryHandler  
(  !
ICategoryRepository 
categoryRepository .
,. /
IMessageBusClient 

messageBus $
)$ %
{ 
_categoryRepository 
= 
categoryRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Unit 
> 
Handle "
(" #!
DeleteCategoryCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
await 
_categoryRepository .
.. /
GetById/ 6
(6 7
request7 >
.> ?
Id? A
)A B
;B C
if 

( 
entity 
== 
null 
) 
{ 	
var   
noticiation   
=   
new   !
NotificationError  " 3
(  3 4
$str  4 O
,  O P
$str  Q l
)  l m
;  m n
var!! 

routingKey!! 
=!! 
noticiation!! (
.!!( )
GetType!!) 0
(!!0 1
)!!1 2
.!!2 3
Name!!3 7
.!!7 8

ToDashCase!!8 B
(!!B C
)!!C D
;!!D E
_messageBus## 
.## 
Publish## 
(##  
noticiation##  +
,##+ ,

routingKey##- 7
,##7 8
$str##9 N
)##N O
;##O P
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 6
)%%6 7
;%%7 8
}&& 	
await(( 
_categoryRepository(( !
.((! "
Remove((" (
(((( )
entity(() /
.((/ 0
Id((0 2
)((2 3
;((3 4
return** 
Unit** 
.** 
Value** 
;** 
}++ 
},, –
D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\Handlers\CreateCategoryCommandHandler.cs
	namespace

 	
e_Estoque_API


 
.

 
Application

 #
.

# $

Categories

$ .
.

. /
Commands

/ 7
.

7 8
Handlers

8 @
;

@ A
public 
class (
CreateCategoryCommandHandler )
:* +
IRequestHandler, ;
<; <!
CreateCategoryCommand< Q
,Q R
GuidS W
>W X
{ 
private 
readonly 
ICategoryRepository (
_categoryRepository) <
;< =
private 
readonly 
IMessageBusClient &
_messageBus' 2
;2 3
public 
(
CreateCategoryCommandHandler '
(' (
ICategoryRepository( ;
categoryRepository< N
,N O
IMessageBusClient( 9

messageBus: D
)D E
{ 
_categoryRepository 
= 
categoryRepository 0
;0 1
_messageBus 
= 

messageBus  
;  !
} 
public 

async 
Task 
< 
Guid 
> 
Handle "
(" #!
CreateCategoryCommand 
request %
,% &
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
entity 
= 
Category 
. 
Create $
($ %
request 
. 
Name 
, 
request 
. 
Description 
,  
request 
. 
ShortDescription $
)$ %
;% &
if!! 

(!! 
!!! 
	Validator!! 
.!! 
Validate!! 
(!!  
new!!  #
CategoryValidation!!$ 6
(!!6 7
)!!7 8
,!!8 9
entity!!: @
)!!@ A
)!!A B
{"" 	
var## 
noticiation## 
=## 
new## !
NotificationError##" 3
(##3 4
$str##4 Q
,##Q R
$str##S p
)##p q
;##q r
var$$ 

routingKey$$ 
=$$ 
noticiation$$ (
.$$( )
GetType$$) 0
($$0 1
)$$1 2
.$$2 3
Name$$3 7
.$$7 8

ToDashCase$$8 B
($$B C
)$$C D
;$$D E
_messageBus&& 
.&& 
Publish&& 
(&&  
noticiation&&  +
,&&+ ,

routingKey&&- 7
,&&7 8
$str&&9 N
)&&N O
;&&O P
throw(( 
new(( 
ValidationException(( )
((() *
$str((* :
)((: ;
;((; <
})) 	
await++ 
_categoryRepository++ !
.++! "
Add++" %
(++% &
entity++& ,
)++, -
;++- .
foreach-- 
(-- 
var-- 
@event-- 
in-- 
entity-- %
.--% &
Events--& ,
)--, -
{.. 	
var// 

routingKey// 
=// 
@event// #
.//# $
GetType//$ +
(//+ ,
)//, -
.//- .
Name//. 2
.//2 3

ToDashCase//3 =
(//= >
)//> ?
;//? @
_messageBus11 
.11 
Publish11 
(11  
@event11  &
,11& '

routingKey11( 2
,112 3
$str114 F
)11F G
;11G H
}22 	
return44 
entity44 
.44 
Id44 
;44 
}55 
}66 ¬
oD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\DeleteCategoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Commands/ 7
;7 8
public 
class !
DeleteCategoryCommand "
:# $
IRequest% -
<- .
Unit. 2
>2 3
{ 
public 
!
DeleteCategoryCommand  
(  !
Guid! %
id& (
)( )
{ 
Id		 

=		 
id		 
;		 
}

 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} ≤	
oD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Categories\Commands\CreateCategoryCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $

Categories$ .
.. /
Commands/ 7
;7 8
public 
class !
CreateCategoryCommand "
:# $
IRequest% -
<- .
Guid. 2
>2 3
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public		 

string		 
ShortDescription		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
=		1 2
string		3 9
.		9 :
Empty		: ?
;		? @
}

 Æ
]D:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\ViewModels\UserDto.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )

ViewModels) 3
;3 4
public 
class 
UserDto 
{ 
public 


Attributes 

attributes  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
new1 4

Attributes5 ?
(? @
)@ A
;A B
public 


Credential 
[ 
] 
credentials #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
new4 7

Credential8 B
[B C
$numC D
]D E
;E F
public 

string 
username 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
	firstName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 

string		 
lastName		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
=		) *
string		+ 1
.		1 2
Empty		2 7
;		7 8
public

 

string

 
email

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
=

& '
string

( .
.

. /
Empty

/ 4
;

4 5
public 

bool 
emailVerified 
{ 
get  #
;# $
set% (
;( )
}* +
public 

bool 
enabled 
{ 
get 
; 
set "
;" #
}$ %
} 
public 
class 

Attributes 
{ 
public 

string 
attribute_key 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
} 
public 
class 

Credential 
{ 
public 

bool 
	temporary 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
type 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
value 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
} €
dD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\ViewModels\TokenViewModel.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )

ViewModels) 3
;3 4
public 
class 
TokenViewModel 
{ 
public 

string 
AccessToken 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

int 
	ExpiresIn 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
RefreshToken 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

int 
RefreshExpiresIn 
{  !
get" %
;% &
set' *
;* +
}, -
public		 

string		 
	TokenType		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
=		* +
string		, 2
.		2 3
Empty		3 8
;		8 9
public

 

string

 
NotBeforePolicy

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
=

0 1
string

2 8
.

8 9
Empty

9 >
;

> ?
public 

string 
SessionState 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
Scope 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
} 
gD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\Commands\RegisterUserCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )
Commands) 1
;1 2
public 
class 
RegisterUserCommand  
:! "
IRequest# +
<+ ,
TokenViewModel, :
>: ;
{ 
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public		 

string		 
Password		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
=		) *
string		+ 1
.		1 2
Empty		2 7
;		7 8
public

 

string

 
Email

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
=

& '
string

( .
.

. /
Empty

/ 4
;

4 5
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
Token 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
} Ø
dD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\Commands\LoginUserCommand.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )
Commands) 1
;1 2
public 
class 
LoginUserCommand 
: 
IRequest  (
<( )
TokenViewModel) 7
>7 8
{ 
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public		 

string		 
Password		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
=		) *
string		+ 1
.		1 2
Empty		2 7
;		7 8
}

 «+
wD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\Commands\Handlers\RegisterUserCommandHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )
Commands) 1
.1 2
Handlers2 :
;: ;
public

 
class

 &
RegisterUserCommandHandler

 '
:

( )
IRequestHandler

* 9
<

9 :
RegisterUserCommand

: M
,

M N
TokenViewModel

O ]
>

] ^
{ 
private 
readonly 
IHttpClientFactory '
_clientFactory( 6
;6 7
private 
readonly 
Keycloak 
	_keycloak '
;' (
private 
readonly 
	IMediator 
	_mediator (
;( )
public 
&
RegisterUserCommandHandler %
(% &
IHttpClientFactory& 8
clientFactory9 F
,F G
KeycloakH P
keycloakQ Y
,Y Z
	IMediator[ d
mediatore m
)m n
{ 
_clientFactory 
= 
clientFactory &
;& '
	_keycloak 
= 
keycloak 
; 
	_mediator 
= 
mediator 
; 
} 
public 

async 
Task 
< 
TokenViewModel $
>$ %
Handle& ,
(, -
RegisterUserCommand 
request #
,# $
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
client 
= 
_clientFactory #
.# $
CreateClient$ 0
(0 1
)1 2
;2 3
var 
url 
= 
$" 
{ 
	_keycloak 
. 
AuthServerUrl ,
}, -
$str- :
{: ;
	_keycloak; D
.D E
RealmE J
}J K
$strK Q
"Q R
;R S
var 
httpRequest 
= 
new 
HttpRequestMessage 0
(0 1

HttpMethod1 ;
.; <
Post< @
,@ A
urlB E
)E F
;F G
var 
user 
= 
new 
UserDto 
( 
)  
{   	

attributes!! 
=!! 
new!! 

Attributes!! '
(!!' (
)!!( )
{!!* +
attribute_key!!, 9
=!!: ;
$str!!< D
}!!E F
,!!F G
credentials"" 
="" 
new"" 

Credential"" (
[""( )
]"") *
{""+ ,
new""- 0

Credential""1 ;
(""; <
)""< =
{""> ?
	temporary""@ I
=""J K
false""L Q
,""Q R
type""S W
=""X Y
$str""Z d
,""d e
value""f k
=""l m
request""n u
.""u v
Password""v ~
}	"" Ä
}
""Å Ç
,
""Ç É
username## 
=## 
request## 
.## 
Username## '
,##' (
	firstName$$ 
=$$ 
request$$ 
.$$  
	FirstName$$  )
,$$) *
lastName%% 
=%% 
request%% 
.%% 
LastName%% '
,%%' (
email&& 
=&& 
request&& 
.&& 
Email&& !
,&&! "
emailVerified'' 
='' 
true''  
,''  !
enabled(( 
=(( 
true(( 
,(( 
})) 	
;))	 

httpRequest++ 
.++ 
Content++ 
=++ 
new++ !
StringContent++" /
(++/ 0
JsonSerializer++0 >
.++> ?
	Serialize++? H
(++H I
user++I M
)++M N
,++N O
Encoding++P X
.++X Y
UTF8++Y ]
,++] ^
$str++_ q
)++q r
;++r s
httpRequest-- 
.-- 
Headers-- 
.-- 
Add-- 
(--  
$str--  /
,--/ 0
$"--1 3
$str--3 :
{--: ;
request--; B
.--B C
Token--C H
}--H I
"--I J
)--J K
;--K L
var.. 
response.. 
=.. 
await.. 
client.. #
...# $
	SendAsync..$ -
(..- .
httpRequest... 9
)..9 :
;..: ;
if00 

(00 
!00 
response00 
.00 
IsSuccessStatusCode00 )
)00) *
{11 	
throw22 
new22 $
ForbiddenAccessException22 .
(22. /
$str22/ D
)22D E
;22E F
}33 	
return55 
await55 
	_mediator55 
.55 
Send55 #
(55# $
new55$ '
LoginUserCommand55( 8
(558 9
)559 :
{55; <
Username55= E
=55F G
request55H O
.55O P
Username55P X
,55X Y
Password55Z b
=55c d
request55e l
.55l m
Password55m u
}55v w
)55w x
;55x y
}66 
}77 û$
tD:\TI\git\v2\e-Estoque-API\e-Estoque-API\e-Estoque-API.Application\Auth\Commands\Handlers\LoginUserCommandHandler.cs
	namespace 	
e_Estoque_API
 
. 
Application #
.# $
Auth$ (
.( )
Commands) 1
.1 2
Handlers2 :
;: ;
public		 
class		 #
LoginUserCommandHandler		 $
:		% &
IRequestHandler		' 6
<		6 7
LoginUserCommand		7 G
,		G H
TokenViewModel		I W
>		W X
{

 
private 
readonly 
IHttpClientFactory '
_clientFactory( 6
;6 7
private 
readonly 
Keycloak 
	_keycloak '
;' (
public 
#
LoginUserCommandHandler "
(" #
IHttpClientFactory# 5
httpClientFactory6 G
,G H
KeycloakI Q
keycloakR Z
)Z [
{ 
_clientFactory 
= 
httpClientFactory *
;* +
	_keycloak 
= 
keycloak 
; 
} 
public 

async 
Task 
< 
TokenViewModel $
>$ %
Handle& ,
(, -
LoginUserCommand 
request  
,  !
CancellationToken 
cancellationToken +
)+ ,
{ 
var 
client 
= 
_clientFactory #
.# $
CreateClient$ 0
(0 1
)1 2
;2 3
var 
url 
= 
$" 
{ 
	_keycloak 
. 
AuthServerUrl ,
}, -
$str- 4
{4 5
	_keycloak5 >
.> ?
Realm? D
}D E
$strE c
"c d
;d e
var 
httpRequest 
= 
new 
HttpRequestMessage 0
(0 1

HttpMethod1 ;
.; <
Post< @
,@ A
urlB E
)E F
;F G
var 
formurlencoded 
= 
new  

Dictionary! +
<+ ,
string, 2
,2 3
string4 :
>: ;
{ 	
{ 
$str 
, 
$str &
}' (
,( )
{ 
$str 
, 
	_keycloak $
.$ %
Resource% -
}. /
,/ 0
{   
$str   
,   
request   !
.  ! "
Username  " *
}  + ,
,  , -
{!! 
$str!! 
,!! 
request!! !
.!!! "
Password!!" *
}!!+ ,
,!!, -
{"" 
$str"" 
,"" 
	_keycloak"" (
.""( )
Credentials"") 4
.""4 5
Secret""5 ;
}""< =
,""= >
}## 	
;##	 

httpRequest$$ 
.$$ 
Content$$ 
=$$ 
new$$ !!
FormUrlEncodedContent$$" 7
($$7 8
formurlencoded$$8 F
)$$F G
;$$G H
var%% 
response%% 
=%% 
await%% 
client%% #
.%%# $
	SendAsync%%$ -
(%%- .
httpRequest%%. 9
)%%9 :
.%%: ;
Result%%; A
.%%A B
Content%%B I
.%%I J
ReadAsStringAsync%%J [
(%%[ \
)%%\ ]
;%%] ^
var'' 
serializeOptions'' 
='' 
new'' "!
JsonSerializerOptions''# 8
{(( 	 
PropertyNamingPolicy))  
=))! "
JsonNamingPolicy))# 3
.))3 4
SnakeCaseLower))4 B
,))B C
WriteIndented** 
=** 
true**  
}++ 	
;++	 

var-- 
token-- 
=-- 
JsonSerializer-- "
.--" #
Deserialize--# .
<--. /
TokenViewModel--/ =
>--= >
(--> ?
response--? G
,--G H
serializeOptions--I Y
)--Y Z
;--Z [
if// 

(// 
token// 
==// 
null// 
)// 
throw00 
new00 $
ForbiddenAccessException00 .
(00. /
$str00/ M
)00M N
;00N O
return22 
token22 
;22 
}33 
}44 